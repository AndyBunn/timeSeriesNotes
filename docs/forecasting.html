<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>8 Forecasting | A collection of note for ESCI 504</title>
  <meta name="description" content="Helpful materials for ESCI 504" />
  <meta name="generator" content="bookdown 0.43 and GitBook 2.6.7" />

  <meta property="og:title" content="8 Forecasting | A collection of note for ESCI 504" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Helpful materials for ESCI 504" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="8 Forecasting | A collection of note for ESCI 504" />
  
  <meta name="twitter:description" content="Helpful materials for ESCI 504" />
  

<meta name="author" content="Andy Bunn" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="armapq.html"/>
<link rel="next" href="cross-correlation.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.33/datatables.js"></script>
<link href="libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>

<script>
/* ========================================================================
 * Bootstrap: transition.js v3.3.7
 * http://getbootstrap.com/javascript/#transitions
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // CSS TRANSITION SUPPORT (Shoutout: http://www.modernizr.com/)
  // ============================================================

  function transitionEnd() {
    var el = document.createElement('bootstrap')

    var transEndEventNames = {
      WebkitTransition : 'webkitTransitionEnd',
      MozTransition    : 'transitionend',
      OTransition      : 'oTransitionEnd otransitionend',
      transition       : 'transitionend'
    }

    for (var name in transEndEventNames) {
      if (el.style[name] !== undefined) {
        return { end: transEndEventNames[name] }
      }
    }

    return false // explicit for ie8 (  ._.)
  }

  // http://blog.alexmaccaw.com/css-transitions
  $.fn.emulateTransitionEnd = function (duration) {
    var called = false
    var $el = this
    $(this).one('bsTransitionEnd', function () { called = true })
    var callback = function () { if (!called) $($el).trigger($.support.transition.end) }
    setTimeout(callback, duration)
    return this
  }

  $(function () {
    $.support.transition = transitionEnd()

    if (!$.support.transition) return

    $.event.special.bsTransitionEnd = {
      bindType: $.support.transition.end,
      delegateType: $.support.transition.end,
      handle: function (e) {
        if ($(e.target).is(this)) return e.handleObj.handler.apply(this, arguments)
      }
    }
  })

}(jQuery);
</script>
<script>
/* ========================================================================
 * Bootstrap: collapse.js v3.3.7
 * http://getbootstrap.com/javascript/#collapse
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */

/* jshint latedef: false */

+function ($) {
  'use strict';

  // COLLAPSE PUBLIC CLASS DEFINITION
  // ================================

  var Collapse = function (element, options) {
    this.$element      = $(element)
    this.options       = $.extend({}, Collapse.DEFAULTS, options)
    this.$trigger      = $('[data-toggle="collapse"][href="#' + element.id + '"],' +
                           '[data-toggle="collapse"][data-target="#' + element.id + '"]')
    this.transitioning = null

    if (this.options.parent) {
      this.$parent = this.getParent()
    } else {
      this.addAriaAndCollapsedClass(this.$element, this.$trigger)
    }

    if (this.options.toggle) this.toggle()
  }

  Collapse.VERSION  = '3.3.7'

  Collapse.TRANSITION_DURATION = 350

  Collapse.DEFAULTS = {
    toggle: true
  }

  Collapse.prototype.dimension = function () {
    var hasWidth = this.$element.hasClass('width')
    return hasWidth ? 'width' : 'height'
  }

  Collapse.prototype.show = function () {
    if (this.transitioning || this.$element.hasClass('in')) return

    var activesData
    var actives = this.$parent && this.$parent.children('.panel').children('.in, .collapsing')

    if (actives && actives.length) {
      activesData = actives.data('bs.collapse')
      if (activesData && activesData.transitioning) return
    }

    var startEvent = $.Event('show.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    if (actives && actives.length) {
      Plugin.call(actives, 'hide')
      activesData || actives.data('bs.collapse', null)
    }

    var dimension = this.dimension()

    this.$element
      .removeClass('collapse')
      .addClass('collapsing')[dimension](0)
      .attr('aria-expanded', true)

    this.$trigger
      .removeClass('collapsed')
      .attr('aria-expanded', true)

    this.transitioning = 1

    var complete = function () {
      this.$element
        .removeClass('collapsing')
        .addClass('collapse in')[dimension]('')
      this.transitioning = 0
      this.$element
        .trigger('shown.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    var scrollSize = $.camelCase(['scroll', dimension].join('-'))

    this.$element
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)[dimension](this.$element[0][scrollSize])
  }

  Collapse.prototype.hide = function () {
    if (this.transitioning || !this.$element.hasClass('in')) return

    var startEvent = $.Event('hide.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    var dimension = this.dimension()

    this.$element[dimension](this.$element[dimension]())[0].offsetHeight

    this.$element
      .addClass('collapsing')
      .removeClass('collapse in')
      .attr('aria-expanded', false)

    this.$trigger
      .addClass('collapsed')
      .attr('aria-expanded', false)

    this.transitioning = 1

    var complete = function () {
      this.transitioning = 0
      this.$element
        .removeClass('collapsing')
        .addClass('collapse')
        .trigger('hidden.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    this.$element
      [dimension](0)
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)
  }

  Collapse.prototype.toggle = function () {
    this[this.$element.hasClass('in') ? 'hide' : 'show']()
  }

  Collapse.prototype.getParent = function () {
    return $(this.options.parent)
      .find('[data-toggle="collapse"][data-parent="' + this.options.parent + '"]')
      .each($.proxy(function (i, element) {
        var $element = $(element)
        this.addAriaAndCollapsedClass(getTargetFromTrigger($element), $element)
      }, this))
      .end()
  }

  Collapse.prototype.addAriaAndCollapsedClass = function ($element, $trigger) {
    var isOpen = $element.hasClass('in')

    $element.attr('aria-expanded', isOpen)
    $trigger
      .toggleClass('collapsed', !isOpen)
      .attr('aria-expanded', isOpen)
  }

  function getTargetFromTrigger($trigger) {
    var href
    var target = $trigger.attr('data-target')
      || (href = $trigger.attr('href')) && href.replace(/.*(?=#[^\s]+$)/, '') // strip for ie7

    return $(target)
  }


  // COLLAPSE PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this   = $(this)
      var data    = $this.data('bs.collapse')
      var options = $.extend({}, Collapse.DEFAULTS, $this.data(), typeof option == 'object' && option)

      if (!data && options.toggle && /show|hide/.test(option)) options.toggle = false
      if (!data) $this.data('bs.collapse', (data = new Collapse(this, options)))
      if (typeof option == 'string') data[option]()
    })
  }

  var old = $.fn.collapse

  $.fn.collapse             = Plugin
  $.fn.collapse.Constructor = Collapse


  // COLLAPSE NO CONFLICT
  // ====================

  $.fn.collapse.noConflict = function () {
    $.fn.collapse = old
    return this
  }


  // COLLAPSE DATA-API
  // =================

  $(document).on('click.bs.collapse.data-api', '[data-toggle="collapse"]', function (e) {
    var $this   = $(this)

    if (!$this.attr('data-target')) e.preventDefault()

    var $target = getTargetFromTrigger($this)
    var data    = $target.data('bs.collapse')
    var option  = data ? 'toggle' : $this.data()

    Plugin.call($target, option)
  })

}(jQuery);
</script>
<script>
window.initializeCodeFolding = function(show) {

  // handlers for show-all and hide all
  $("#rmd-show-all-code").click(function() {
    // close the dropdown menu when an option is clicked
    $("#allCodeButton").dropdown("toggle");
    $('div.r-code-collapse').each(function() {
      $(this).collapse('show');
    });
  });
  $("#rmd-hide-all-code").click(function() {
    // close the dropdown menu when an option is clicked
    $("#allCodeButton").dropdown("toggle");
    $('div.r-code-collapse').each(function() {
      $(this).collapse('hide');
    });
  });

  // index for unique code element ids
  var currentIndex = 1;

  // select all R code blocks
  var rCodeBlocks = $('pre.sourceCode, pre.r, pre.python, pre.bash, pre.sql, pre.cpp, pre.stan');
  rCodeBlocks.each(function() {

    // if code block has been labeled with class `fold-show`, show the code on init!
    var classList = $(this).attr('class').split(/\s+/);
    for (var i = 0; i < classList.length; i++) {
    if (classList[i] === 'fold-show') {
        show = true;
      }
      // AGB add fold-hide
    if (classList[i] === 'fold-hide') {
        show = false;
      }
    }
    // AGB
    // if code block has been labeled with class `fold-hide`, hide the code on init!
//    var classList = $(this).attr('class').split(/\s+/);
//    for (var i = 0; i < classList.length; i++) {
//    if (classList[i] === 'fold-hide') {
//        show = false;
//      }
//    }

    // create a collapsable div to wrap the code in
    var div = $('<div class="collapse r-code-collapse"></div>');
    if (show)
      div.addClass('in');
    var id = 'rcode-643E0F36' + currentIndex++;
    div.attr('id', id);
    $(this).before(div);
    $(this).detach().appendTo(div);

    // add a show code button right above
    var showCodeText = $('<span>' + (show ? 'Hide' : 'Code') + '</span>');
    var showCodeButton = $('<button type="button" class="btn btn-default btn-xs code-folding-btn pull-right"></button>');
    showCodeButton.append(showCodeText);
    showCodeButton
        .attr('data-toggle', 'collapse')
        .attr('data-target', '#' + id)
        .attr('aria-expanded', show)
        .attr('aria-controls', id);

    var buttonRow = $('<div class="row"></div>');
    var buttonCol = $('<div class="col-md-12"></div>');

    buttonCol.append(showCodeButton);
    buttonRow.append(buttonCol);

    div.before(buttonRow);

    // hack: return show to false, otherwise all next codeBlocks will be shown!
    show = true;

    // update state of button on show/hide
    div.on('hidden.bs.collapse', function () {
      showCodeText.text('Code');
    });
    div.on('show.bs.collapse', function () {
      showCodeText.text('Hide');
    });
  });

}
</script>
<script>
/* ========================================================================
 * Bootstrap: dropdown.js v3.3.7
 * http://getbootstrap.com/javascript/#dropdowns
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // DROPDOWN CLASS DEFINITION
  // =========================

  var backdrop = '.dropdown-backdrop'
  var toggle   = '[data-toggle="dropdown"]'
  var Dropdown = function (element) {
    $(element).on('click.bs.dropdown', this.toggle)
  }

  Dropdown.VERSION = '3.3.7'

  function getParent($this) {
    var selector = $this.attr('data-target')

    if (!selector) {
      selector = $this.attr('href')
      selector = selector && /#[A-Za-z]/.test(selector) && selector.replace(/.*(?=#[^\s]*$)/, '') // strip for ie7
    }

    var $parent = selector && $(selector)

    return $parent && $parent.length ? $parent : $this.parent()
  }

  function clearMenus(e) {
    if (e && e.which === 3) return
    $(backdrop).remove()
    $(toggle).each(function () {
      var $this         = $(this)
      var $parent       = getParent($this)
      var relatedTarget = { relatedTarget: this }

      if (!$parent.hasClass('open')) return

      if (e && e.type == 'click' && /input|textarea/i.test(e.target.tagName) && $.contains($parent[0], e.target)) return

      $parent.trigger(e = $.Event('hide.bs.dropdown', relatedTarget))

      if (e.isDefaultPrevented()) return

      $this.attr('aria-expanded', 'false')
      $parent.removeClass('open').trigger($.Event('hidden.bs.dropdown', relatedTarget))
    })
  }

  Dropdown.prototype.toggle = function (e) {
    var $this = $(this)

    if ($this.is('.disabled, :disabled')) return

    var $parent  = getParent($this)
    var isActive = $parent.hasClass('open')

    clearMenus()

    if (!isActive) {
      if ('ontouchstart' in document.documentElement && !$parent.closest('.navbar-nav').length) {
        // if mobile we use a backdrop because click events don't delegate
        $(document.createElement('div'))
          .addClass('dropdown-backdrop')
          .insertAfter($(this))
          .on('click', clearMenus)
      }

      var relatedTarget = { relatedTarget: this }
      $parent.trigger(e = $.Event('show.bs.dropdown', relatedTarget))

      if (e.isDefaultPrevented()) return

      $this
        .trigger('focus')
        .attr('aria-expanded', 'true')

      $parent
        .toggleClass('open')
        .trigger($.Event('shown.bs.dropdown', relatedTarget))
    }

    return false
  }

  Dropdown.prototype.keydown = function (e) {
    if (!/(38|40|27|32)/.test(e.which) || /input|textarea/i.test(e.target.tagName)) return

    var $this = $(this)

    e.preventDefault()
    e.stopPropagation()

    if ($this.is('.disabled, :disabled')) return

    var $parent  = getParent($this)
    var isActive = $parent.hasClass('open')

    if (!isActive && e.which != 27 || isActive && e.which == 27) {
      if (e.which == 27) $parent.find(toggle).trigger('focus')
      return $this.trigger('click')
    }

    var desc = ' li:not(.disabled):visible a'
    var $items = $parent.find('.dropdown-menu' + desc)

    if (!$items.length) return

    var index = $items.index(e.target)

    if (e.which == 38 && index > 0)                 index--         // up
    if (e.which == 40 && index < $items.length - 1) index++         // down
    if (!~index)                                    index = 0

    $items.eq(index).trigger('focus')
  }


  // DROPDOWN PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this = $(this)
      var data  = $this.data('bs.dropdown')

      if (!data) $this.data('bs.dropdown', (data = new Dropdown(this)))
      if (typeof option == 'string') data[option].call($this)
    })
  }

  var old = $.fn.dropdown

  $.fn.dropdown             = Plugin
  $.fn.dropdown.Constructor = Dropdown


  // DROPDOWN NO CONFLICT
  // ====================

  $.fn.dropdown.noConflict = function () {
    $.fn.dropdown = old
    return this
  }


  // APPLY TO STANDARD DROPDOWN ELEMENTS
  // ===================================

  $(document)
    .on('click.bs.dropdown.data-api', clearMenus)
    .on('click.bs.dropdown.data-api', '.dropdown form', function (e) { e.stopPropagation() })
    .on('click.bs.dropdown.data-api', toggle, Dropdown.prototype.toggle)
    .on('keydown.bs.dropdown.data-api', toggle, Dropdown.prototype.keydown)
    .on('keydown.bs.dropdown.data-api', '.dropdown-menu', Dropdown.prototype.keydown)

}(jQuery);
</script>
<style type="text/css">
.code-folding-btn {
  margin-bottom: 4px;
}

.row { display: flex; }
.collapse { display: none; }
.in { display:block }
.pull-right > .dropdown-menu {
    right: 0;
    left: auto;
}

.dropdown-menu {
    position: absolute;
    top: 100%;
    left: 0;
    z-index: 1000;
    display: none;
    float: left;
    min-width: 160px;
    padding: 5px 0;
    margin: 2px 0 0;
    font-size: 14px;
    text-align: left;
    list-style: none;
    background-color: #fff;
    -webkit-background-clip: padding-box;
    background-clip: padding-box;
    border: 1px solid #ccc;
    border: 1px solid rgba(0,0,0,.15);
    border-radius: 4px;
    -webkit-box-shadow: 0 6px 12px rgba(0,0,0,.175);
    box-shadow: 0 6px 12px rgba(0,0,0,.175);
}

.open > .dropdown-menu {
    display: block;
    color: #ffffff;
    background-color: #ffffff;
    background-image: none;
    border-color: #92897e;
}

.dropdown-menu > li > a {
  display: block;
  padding: 3px 20px;
  clear: both;
  font-weight: 400;
  line-height: 1.42857143;
  color: #000000;
  white-space: nowrap;
}

.dropdown-menu > li > a:hover,
.dropdown-menu > li > a:focus {
  color: #ffffff;
  text-decoration: none;
  background-color: #e95420;
}

.dropdown-menu > .active > a,
.dropdown-menu > .active > a:hover,
.dropdown-menu > .active > a:focus {
  color: #ffffff;
  text-decoration: none;
  background-color: #e95420;
  outline: 0;
}
.dropdown-menu > .disabled > a,
.dropdown-menu > .disabled > a:hover,
.dropdown-menu > .disabled > a:focus {
  color: #aea79f;
}

.dropdown-menu > .disabled > a:hover,
.dropdown-menu > .disabled > a:focus {
  text-decoration: none;
  cursor: not-allowed;
  background-color: transparent;
  background-image: none;
  filter: progid:DXImageTransform.Microsoft.gradient(enabled = false);
}

.btn {
  display: inline-block;
  margin-bottom: 1;
  font-weight: normal;
  text-align: center;
  white-space: nowrap;
  vertical-align: middle;
  -ms-touch-action: manipulation;
      touch-action: manipulation;
  cursor: pointer;
  background-image: none;
  border: 1px solid transparent;
  padding: 4px 8px;
  font-size: 14px;
  line-height: 1.42857143;
  border-radius: 4px;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.btn:focus,
.btn:active:focus,
.btn.active:focus,
.btn.focus,
.btn:active.focus,
.btn.active.focus {
  outline: 5px auto -webkit-focus-ring-color;
  outline-offset: -2px;
}
.btn:hover,
.btn:focus,
.btn.focus {
  color: #ffffff;
  text-decoration: none;
}
.btn:active,
.btn.active {
  background-image: none;
  outline: 0;
  box-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.125);
}
.btn.disabled,
.btn[disabled],
fieldset[disabled] .btn {
  cursor: not-allowed;
  filter: alpha(opacity=65);
  opacity: 0.65;
  box-shadow: none;
}
a.btn.disabled,
fieldset[disabled] a.btn {
  pointer-events: none;
}
.btn-default {
  color: #ffffff;
  background-color: #aea79f; #important
  border-color: #aea79f;
}

.btn-default:focus,
.btn-default.focus {
  color: #ffffff;
  background-color: #978e83;
  border-color: #6f675e;
}

.btn-default:hover {
  color: #ffffff;
  background-color: #978e83;
  border-color: #92897e;
}
.btn-default:active,
.btn-default.active,
.btn-group > .btn:not(:first-child):not(:last-child):not(.dropdown-toggle) {
  border-radius: 0;
}
.btn-group > .btn:first-child {
  margin-left: 0;
}
.btn-group > .btn:first-child:not(:last-child):not(.dropdown-toggle) {
  border-top-right-radius: 0;
  border-bottom-right-radius: 0;
}
.btn-group > .btn:last-child:not(:first-child),
.btn-group > .dropdown-toggle:not(:first-child) {
  border-top-left-radius: 0;
  border-bottom-left-radius: 0;
}
.btn-group > .btn-group {
  float: left;
}
.btn-group > .btn-group:not(:first-child):not(:last-child) > .btn {
  border-radius: 0;
}
.btn-group > .btn-group:first-child:not(:last-child) > .btn:last-child,
.btn-group > .btn-group:first-child:not(:last-child) > .dropdown-toggle {
  border-top-right-radius: 0;
  border-bottom-right-radius: 0;
}
.btn-group > .btn-group:last-child:not(:first-child) > .btn:first-child {
  border-top-left-radius: 0;
  border-bottom-left-radius: 0;
}
.btn-group .dropdown-toggle:active,
.btn-group.open .dropdown-toggle {
  outline: 0;
}
.btn-group > .btn + .dropdown-toggle {
  padding-right: 8px;
  padding-left: 8px;
}
.btn-group > .btn-lg + .dropdown-toggle {
  padding-right: 12px;
  padding-left: 12px;
}
.btn-group.open .dropdown-toggle {
  box-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.125);
}
.btn-group.open .dropdown-toggle.btn-link {
  box-shadow: none;
}

</style>
<script>
var str = '<div class="btn-group pull-right" style="position: fixed; right: 50px; top: 10px; z-index: 200"><button type="button" class="btn btn-default btn-xs dropdown-toggle" id="allCodeButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" data-_extension-text-contrast=""><span>Code</span> <span class="caret"></span></button><ul class="dropdown-menu" style="min-width: 50px;"><li><a id="rmd-show-all-code" href="#">Show All Code</a></li><li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li></ul></div>';
document.write(str);
</script>
<script>
$(document).ready(function () {
  // AGB add fold-hide changed === to !== to default to showing code
  window.initializeCodeFolding("show" !== "hide");
});
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preamble</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#technical-setup"><i class="fa fa-check"></i><b>1.1</b> Technical Setup</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="index.html"><a href="index.html#project-structure"><i class="fa fa-check"></i><b>1.1.1</b> Project Structure</a></li>
<li class="chapter" data-level="1.1.2" data-path="index.html"><a href="index.html#why-use-projects-in-r"><i class="fa fa-check"></i><b>1.1.2</b> Why Use Projects in R?</a></li>
<li class="chapter" data-level="1.1.3" data-path="index.html"><a href="index.html#why-reproducibility-matters"><i class="fa fa-check"></i><b>1.1.3</b> Why Reproducibility Matters</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="the-measure-of-time.html"><a href="the-measure-of-time.html"><i class="fa fa-check"></i><b>2</b> The Measure of Time</a>
<ul>
<li class="chapter" data-level="2.1" data-path="the-measure-of-time.html"><a href="the-measure-of-time.html#big-idea"><i class="fa fa-check"></i><b>2.1</b> Big Idea</a></li>
<li class="chapter" data-level="2.2" data-path="the-measure-of-time.html"><a href="the-measure-of-time.html#reading"><i class="fa fa-check"></i><b>2.2</b> Reading</a></li>
<li class="chapter" data-level="2.3" data-path="the-measure-of-time.html"><a href="the-measure-of-time.html#packages"><i class="fa fa-check"></i><b>2.3</b> Packages</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="the-measure-of-time.html"><a href="the-measure-of-time.html#load"><i class="fa fa-check"></i><b>2.3.1</b> Load</a></li>
<li class="chapter" data-level="2.3.2" data-path="the-measure-of-time.html"><a href="the-measure-of-time.html#keep-up-to-date"><i class="fa fa-check"></i><b>2.3.2</b> Keep Up to Date</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="the-measure-of-time.html"><a href="the-measure-of-time.html#what-kinds-of-data"><i class="fa fa-check"></i><b>2.4</b> What Kinds of Data?</a></li>
<li class="chapter" data-level="2.5" data-path="the-measure-of-time.html"><a href="the-measure-of-time.html#the-ts-class"><i class="fa fa-check"></i><b>2.5</b> The <code>ts</code> Class</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="the-measure-of-time.html"><a href="the-measure-of-time.html#a-very-useful-class"><i class="fa fa-check"></i><b>2.5.1</b> A Very Useful Class</a></li>
<li class="chapter" data-level="2.5.2" data-path="the-measure-of-time.html"><a href="the-measure-of-time.html#digression-describing-a-time-series"><i class="fa fa-check"></i><b>2.5.2</b> Digression: Describing a Time Series</a></li>
<li class="chapter" data-level="2.5.3" data-path="the-measure-of-time.html"><a href="the-measure-of-time.html#more-on-the-ts-index"><i class="fa fa-check"></i><b>2.5.3</b> More on the <code>ts</code> Index</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="the-measure-of-time.html"><a href="the-measure-of-time.html#trend-in-time"><i class="fa fa-check"></i><b>2.6</b> Trend in time</a></li>
<li class="chapter" data-level="2.7" data-path="the-measure-of-time.html"><a href="the-measure-of-time.html#the-zoo-class"><i class="fa fa-check"></i><b>2.7</b> The <code>zoo</code> Class</a></li>
<li class="chapter" data-level="2.8" data-path="the-measure-of-time.html"><a href="the-measure-of-time.html#lubricate-the-dates"><i class="fa fa-check"></i><b>2.8</b> Lubricate the Dates</a></li>
<li class="chapter" data-level="2.9" data-path="the-measure-of-time.html"><a href="the-measure-of-time.html#tidy-it-up"><i class="fa fa-check"></i><b>2.9</b> Tidy it Up</a></li>
<li class="chapter" data-level="2.10" data-path="the-measure-of-time.html"><a href="the-measure-of-time.html#your-work"><i class="fa fa-check"></i><b>2.10</b> Your Work</a>
<ul>
<li class="chapter" data-level="2.10.1" data-path="the-measure-of-time.html"><a href="the-measure-of-time.html#berkeley-earth-temperature-data"><i class="fa fa-check"></i><b>2.10.1</b> Berkeley Earth Temperature Data</a></li>
<li class="chapter" data-level="2.10.2" data-path="the-measure-of-time.html"><a href="the-measure-of-time.html#your-turn"><i class="fa fa-check"></i><b>2.10.2</b> Your Turn</a></li>
<li class="chapter" data-level="2.10.3" data-path="the-measure-of-time.html"><a href="the-measure-of-time.html#write-up-and-reflect"><i class="fa fa-check"></i><b>2.10.3</b> Write Up and Reflect</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="an-aside-understanding-methods-and-generics-in-r.html"><a href="an-aside-understanding-methods-and-generics-in-r.html"><i class="fa fa-check"></i><b>3</b> An Aside: Understanding Methods and Generics in R</a>
<ul>
<li class="chapter" data-level="3.1" data-path="an-aside-understanding-methods-and-generics-in-r.html"><a href="an-aside-understanding-methods-and-generics-in-r.html#youve-come-a-long-way-in-r"><i class="fa fa-check"></i><b>3.1</b> You’ve Come a Long Way in R</a></li>
<li class="chapter" data-level="3.2" data-path="an-aside-understanding-methods-and-generics-in-r.html"><a href="an-aside-understanding-methods-and-generics-in-r.html#why-use-generics"><i class="fa fa-check"></i><b>3.2</b> Why Use Generics?</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="an-aside-understanding-methods-and-generics-in-r.html"><a href="an-aside-understanding-methods-and-generics-in-r.html#same-function-different-behavior-what-gives"><i class="fa fa-check"></i><b>3.2.1</b> Same Function, Different Behavior — What Gives?</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="an-aside-understanding-methods-and-generics-in-r.html"><a href="an-aside-understanding-methods-and-generics-in-r.html#how-this-works"><i class="fa fa-check"></i><b>3.3</b> How This Works</a></li>
<li class="chapter" data-level="3.4" data-path="an-aside-understanding-methods-and-generics-in-r.html"><a href="an-aside-understanding-methods-and-generics-in-r.html#whats-the-difference-between-a-generic-and-a-method"><i class="fa fa-check"></i><b>3.4</b> What’s the Difference Between a Generic and a Method?</a></li>
<li class="chapter" data-level="3.5" data-path="an-aside-understanding-methods-and-generics-in-r.html"><a href="an-aside-understanding-methods-and-generics-in-r.html#common-generic-functions"><i class="fa fa-check"></i><b>3.5</b> Common Generic Functions</a></li>
<li class="chapter" data-level="3.6" data-path="an-aside-understanding-methods-and-generics-in-r.html"><a href="an-aside-understanding-methods-and-generics-in-r.html#how-to-explore-and-understand-methods"><i class="fa fa-check"></i><b>3.6</b> How to Explore and Understand Methods</a></li>
<li class="chapter" data-level="3.7" data-path="an-aside-understanding-methods-and-generics-in-r.html"><a href="an-aside-understanding-methods-and-generics-in-r.html#why-this-matters"><i class="fa fa-check"></i><b>3.7</b> Why This Matters</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="decomposition.html"><a href="decomposition.html"><i class="fa fa-check"></i><b>4</b> Decomposition</a>
<ul>
<li class="chapter" data-level="4.1" data-path="decomposition.html"><a href="decomposition.html#big-idea-1"><i class="fa fa-check"></i><b>4.1</b> Big Idea</a></li>
<li class="chapter" data-level="4.2" data-path="decomposition.html"><a href="decomposition.html#reading-1"><i class="fa fa-check"></i><b>4.2</b> Reading</a></li>
<li class="chapter" data-level="4.3" data-path="decomposition.html"><a href="decomposition.html#packages-1"><i class="fa fa-check"></i><b>4.3</b> Packages</a></li>
<li class="chapter" data-level="4.4" data-path="decomposition.html"><a href="decomposition.html#seasonality-and-decomposition"><i class="fa fa-check"></i><b>4.4</b> Seasonality and decomposition</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="decomposition.html"><a href="decomposition.html#breaking-down-a-series-the-tedious-way"><i class="fa fa-check"></i><b>4.4.1</b> Breaking down a series the tedious way</a></li>
<li class="chapter" data-level="4.4.2" data-path="decomposition.html"><a href="decomposition.html#breaking-down-a-series-the-easy-way"><i class="fa fa-check"></i><b>4.4.2</b> Breaking down a series the easy way</a></li>
<li class="chapter" data-level="4.4.3" data-path="decomposition.html"><a href="decomposition.html#how-does-m-differ-from-the-slope-in-a-lm"><i class="fa fa-check"></i><b>4.4.3</b> How does <code>m</code> differ from the slope in a <code>lm</code>?</a></li>
<li class="chapter" data-level="4.4.4" data-path="decomposition.html"><a href="decomposition.html#warning"><i class="fa fa-check"></i><b>4.4.4</b> Warning</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="decomposition.html"><a href="decomposition.html#stationarity"><i class="fa fa-check"></i><b>4.5</b> Stationarity</a></li>
<li class="chapter" data-level="4.6" data-path="decomposition.html"><a href="decomposition.html#your-work-1"><i class="fa fa-check"></i><b>4.6</b> Your Work</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="decomposition.html"><a href="decomposition.html#air-passengers"><i class="fa fa-check"></i><b>4.6.1</b> Air Passengers</a></li>
<li class="chapter" data-level="4.6.2" data-path="decomposition.html"><a href="decomposition.html#kbli"><i class="fa fa-check"></i><b>4.6.2</b> KBLI</a></li>
<li class="chapter" data-level="4.6.3" data-path="decomposition.html"><a href="decomposition.html#write-up-and-reflect-1"><i class="fa fa-check"></i><b>4.6.3</b> Write Up and Reflect</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="arp-acf-pacf-etc..html"><a href="arp-acf-pacf-etc..html"><i class="fa fa-check"></i><b>5</b> AR(p), ACF, PACF, etc.</a>
<ul>
<li class="chapter" data-level="5.1" data-path="arp-acf-pacf-etc..html"><a href="arp-acf-pacf-etc..html#big-idea-2"><i class="fa fa-check"></i><b>5.1</b> Big Idea</a></li>
<li class="chapter" data-level="5.2" data-path="arp-acf-pacf-etc..html"><a href="arp-acf-pacf-etc..html#reading-2"><i class="fa fa-check"></i><b>5.2</b> Reading</a></li>
<li class="chapter" data-level="5.3" data-path="arp-acf-pacf-etc..html"><a href="arp-acf-pacf-etc..html#packages-2"><i class="fa fa-check"></i><b>5.3</b> Packages</a></li>
<li class="chapter" data-level="5.4" data-path="arp-acf-pacf-etc..html"><a href="arp-acf-pacf-etc..html#correlation-and-covariance"><i class="fa fa-check"></i><b>5.4</b> Correlation and Covariance</a></li>
<li class="chapter" data-level="5.5" data-path="arp-acf-pacf-etc..html"><a href="arp-acf-pacf-etc..html#autocorrelation"><i class="fa fa-check"></i><b>5.5</b> Autocorrelation</a></li>
<li class="chapter" data-level="5.6" data-path="arp-acf-pacf-etc..html"><a href="arp-acf-pacf-etc..html#autocorrelation-function"><i class="fa fa-check"></i><b>5.6</b> Autocorrelation Function</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="arp-acf-pacf-etc..html"><a href="arp-acf-pacf-etc..html#the-very-fun-presentation"><i class="fa fa-check"></i><b>5.6.1</b> The Very Fun Presentation</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="arp-acf-pacf-etc..html"><a href="arp-acf-pacf-etc..html#the-boring-presentation"><i class="fa fa-check"></i><b>5.7</b> The Boring Presentation</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="arp-acf-pacf-etc..html"><a href="arp-acf-pacf-etc..html#tidy"><i class="fa fa-check"></i><b>5.7.1</b> Tidy</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="arp-acf-pacf-etc..html"><a href="arp-acf-pacf-etc..html#partial-autocorrelation-function"><i class="fa fa-check"></i><b>5.8</b> Partial Autocorrelation Function</a>
<ul>
<li class="chapter" data-level="5.8.1" data-path="arp-acf-pacf-etc..html"><a href="arp-acf-pacf-etc..html#pacf"><i class="fa fa-check"></i><b>5.8.1</b> PACF</a></li>
<li class="chapter" data-level="5.8.2" data-path="arp-acf-pacf-etc..html"><a href="arp-acf-pacf-etc..html#underneath-the-hood-of-pacf"><i class="fa fa-check"></i><b>5.8.2</b> Underneath the Hood of PACF</a></li>
</ul></li>
<li class="chapter" data-level="5.9" data-path="arp-acf-pacf-etc..html"><a href="arp-acf-pacf-etc..html#ar1-to-arp"><i class="fa fa-check"></i><b>5.9</b> AR(1) to AR(p)</a></li>
<li class="chapter" data-level="5.10" data-path="arp-acf-pacf-etc..html"><a href="arp-acf-pacf-etc..html#random-walks"><i class="fa fa-check"></i><b>5.10</b> Random walks</a>
<ul>
<li class="chapter" data-level="5.10.1" data-path="arp-acf-pacf-etc..html"><a href="arp-acf-pacf-etc..html#stationarity-is-dead"><i class="fa fa-check"></i><b>5.10.1</b> Stationarity is dead</a></li>
</ul></li>
<li class="chapter" data-level="5.11" data-path="arp-acf-pacf-etc..html"><a href="arp-acf-pacf-etc..html#autocorrelation-examples-with-real-data"><i class="fa fa-check"></i><b>5.11</b> Autocorrelation examples with real data</a>
<ul>
<li class="chapter" data-level="5.11.1" data-path="arp-acf-pacf-etc..html"><a href="arp-acf-pacf-etc..html#nile"><i class="fa fa-check"></i><b>5.11.1</b> Nile</a></li>
<li class="chapter" data-level="5.11.2" data-path="arp-acf-pacf-etc..html"><a href="arp-acf-pacf-etc..html#air-temperature"><i class="fa fa-check"></i><b>5.11.2</b> Air Temperature</a></li>
<li class="chapter" data-level="5.11.3" data-path="arp-acf-pacf-etc..html"><a href="arp-acf-pacf-etc..html#sunspots"><i class="fa fa-check"></i><b>5.11.3</b> Sunspots</a></li>
</ul></li>
<li class="chapter" data-level="5.12" data-path="arp-acf-pacf-etc..html"><a href="arp-acf-pacf-etc..html#choosing-the-order-of-an-arp-model-by-aic"><i class="fa fa-check"></i><b>5.12</b> Choosing the Order of an AR(p) Model by AIC</a></li>
<li class="chapter" data-level="5.13" data-path="arp-acf-pacf-etc..html"><a href="arp-acf-pacf-etc..html#your-work-2"><i class="fa fa-check"></i><b>5.13</b> Your work</a>
<ul>
<li class="chapter" data-level="5.13.1" data-path="arp-acf-pacf-etc..html"><a href="arp-acf-pacf-etc..html#acf-and-pacf-with-different-values-of-phi."><i class="fa fa-check"></i><b>5.13.1</b> ACF and PACF with different values of <span class="math inline">\(\phi\)</span>.</a></li>
<li class="chapter" data-level="5.13.2" data-path="arp-acf-pacf-etc..html"><a href="arp-acf-pacf-etc..html#roll-your-own-ar2"><i class="fa fa-check"></i><b>5.13.2</b> Roll your own AR(2)</a></li>
<li class="chapter" data-level="5.13.3" data-path="arp-acf-pacf-etc..html"><a href="arp-acf-pacf-etc..html#sockeye"><i class="fa fa-check"></i><b>5.13.3</b> Sockeye</a></li>
<li class="chapter" data-level="5.13.4" data-path="arp-acf-pacf-etc..html"><a href="arp-acf-pacf-etc..html#write-up-and-reflect-2"><i class="fa fa-check"></i><b>5.13.4</b> Write Up and Reflect</a></li>
</ul></li>
<li class="chapter" data-level="5.14" data-path="arp-acf-pacf-etc..html"><a href="arp-acf-pacf-etc..html#postscript-a-helpful-plotting-chunk"><i class="fa fa-check"></i><b>5.14</b> Postscript: A Helpful Plotting Chunk</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="aside-why-the-acf-and-pacf-look-the-way-they-do-in-an-ma1-process.html"><a href="aside-why-the-acf-and-pacf-look-the-way-they-do-in-an-ma1-process.html"><i class="fa fa-check"></i><b>6</b> Aside: Why the ACF and PACF Look the Way They Do in an MA(1) Process</a>
<ul>
<li class="chapter" data-level="6.1" data-path="aside-why-the-acf-and-pacf-look-the-way-they-do-in-an-ma1-process.html"><a href="aside-why-the-acf-and-pacf-look-the-way-they-do-in-an-ma1-process.html#introduction"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="aside-why-the-acf-and-pacf-look-the-way-they-do-in-an-ma1-process.html"><a href="aside-why-the-acf-and-pacf-look-the-way-they-do-in-an-ma1-process.html#acf-and-pacf-of-a-single-ma1-simulation"><i class="fa fa-check"></i><b>6.2</b> ACF and PACF of a Single MA(1) Simulation</a></li>
<li class="chapter" data-level="6.3" data-path="aside-why-the-acf-and-pacf-look-the-way-they-do-in-an-ma1-process.html"><a href="aside-why-the-acf-and-pacf-look-the-way-they-do-in-an-ma1-process.html#simulation-study-across-many-ma1-coefficients"><i class="fa fa-check"></i><b>6.3</b> Simulation Study Across Many MA(1) Coefficients</a></li>
<li class="chapter" data-level="6.4" data-path="aside-why-the-acf-and-pacf-look-the-way-they-do-in-an-ma1-process.html"><a href="aside-why-the-acf-and-pacf-look-the-way-they-do-in-an-ma1-process.html#insight-1-pacf-lag-1-underestimates-theta"><i class="fa fa-check"></i><b>6.4</b> Insight 1: PACF Lag 1 Underestimates <span class="math inline">\(\theta\)</span></a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="aside-why-the-acf-and-pacf-look-the-way-they-do-in-an-ma1-process.html"><a href="aside-why-the-acf-and-pacf-look-the-way-they-do-in-an-ma1-process.html#why-this-happens"><i class="fa fa-check"></i><b>6.4.1</b> Why This Happens</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="aside-why-the-acf-and-pacf-look-the-way-they-do-in-an-ma1-process.html"><a href="aside-why-the-acf-and-pacf-look-the-way-they-do-in-an-ma1-process.html#insight-2-pacf-lag-2-is-consistently-negative"><i class="fa fa-check"></i><b>6.5</b> Insight 2: PACF Lag 2 is Consistently Negative</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="aside-why-the-acf-and-pacf-look-the-way-they-do-in-an-ma1-process.html"><a href="aside-why-the-acf-and-pacf-look-the-way-they-do-in-an-ma1-process.html#why-this-happens-1"><i class="fa fa-check"></i><b>6.5.1</b> Why This Happens</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="aside-why-the-acf-and-pacf-look-the-way-they-do-in-an-ma1-process.html"><a href="aside-why-the-acf-and-pacf-look-the-way-they-do-in-an-ma1-process.html#conclusion"><i class="fa fa-check"></i><b>6.6</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="armapq.html"><a href="armapq.html"><i class="fa fa-check"></i><b>7</b> ARMA(p,q)</a>
<ul>
<li class="chapter" data-level="7.1" data-path="armapq.html"><a href="armapq.html#big-idea-3"><i class="fa fa-check"></i><b>7.1</b> Big Idea</a></li>
<li class="chapter" data-level="7.2" data-path="armapq.html"><a href="armapq.html#reading-3"><i class="fa fa-check"></i><b>7.2</b> Reading</a></li>
<li class="chapter" data-level="7.3" data-path="armapq.html"><a href="armapq.html#packages-3"><i class="fa fa-check"></i><b>7.3</b> Packages</a></li>
<li class="chapter" data-level="7.4" data-path="armapq.html"><a href="armapq.html#arp-to-maq"><i class="fa fa-check"></i><b>7.4</b> AR(p) to MA(q)</a></li>
<li class="chapter" data-level="7.5" data-path="armapq.html"><a href="armapq.html#armapq-1"><i class="fa fa-check"></i><b>7.5</b> ARMA(p,q)</a></li>
<li class="chapter" data-level="7.6" data-path="armapq.html"><a href="armapq.html#what-about-arimap-d-q"><i class="fa fa-check"></i><b>7.6</b> What about ARIMA(p, d, q)?</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="armapq.html"><a href="armapq.html#why-do-arma-models-require-stationarity"><i class="fa fa-check"></i><b>7.6.1</b> Why Do ARMA Models Require Stationarity?</a></li>
<li class="chapter" data-level="7.6.2" data-path="armapq.html"><a href="armapq.html#simulated-data"><i class="fa fa-check"></i><b>7.6.2</b> Simulated Data</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="armapq.html"><a href="armapq.html#evaluating-arma-models"><i class="fa fa-check"></i><b>7.7</b> Evaluating ARMA models</a>
<ul>
<li class="chapter" data-level="7.7.1" data-path="armapq.html"><a href="armapq.html#simulated-data-1"><i class="fa fa-check"></i><b>7.7.1</b> Simulated Data</a></li>
<li class="chapter" data-level="7.7.2" data-path="armapq.html"><a href="armapq.html#sst-data"><i class="fa fa-check"></i><b>7.7.2</b> SST Data</a></li>
<li class="chapter" data-level="7.7.3" data-path="armapq.html"><a href="armapq.html#how-do-you-decide-which-information-criterion-to-use"><i class="fa fa-check"></i><b>7.7.3</b> How Do You Decide Which Information Criterion to Use?</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="armapq.html"><a href="armapq.html#your-work-3"><i class="fa fa-check"></i><b>7.8</b> Your work</a>
<ul>
<li class="chapter" data-level="7.8.1" data-path="armapq.html"><a href="armapq.html#bunnies-and-kitties"><i class="fa fa-check"></i><b>7.8.1</b> Bunnies and Kitties</a></li>
<li class="chapter" data-level="7.8.2" data-path="armapq.html"><a href="armapq.html#write-up-and-reflect-3"><i class="fa fa-check"></i><b>7.8.2</b> Write up and Reflect</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="forecasting.html"><a href="forecasting.html"><i class="fa fa-check"></i><b>8</b> Forecasting</a>
<ul>
<li class="chapter" data-level="8.1" data-path="forecasting.html"><a href="forecasting.html#big-idea-4"><i class="fa fa-check"></i><b>8.1</b> Big Idea</a></li>
<li class="chapter" data-level="8.2" data-path="forecasting.html"><a href="forecasting.html#reading-4"><i class="fa fa-check"></i><b>8.2</b> Reading</a></li>
<li class="chapter" data-level="8.3" data-path="forecasting.html"><a href="forecasting.html#packages-4"><i class="fa fa-check"></i><b>8.3</b> Packages</a></li>
<li class="chapter" data-level="8.4" data-path="forecasting.html"><a href="forecasting.html#introduction-1"><i class="fa fa-check"></i><b>8.4</b> Introduction</a></li>
<li class="chapter" data-level="8.5" data-path="forecasting.html"><a href="forecasting.html#a-simple-forecast"><i class="fa fa-check"></i><b>8.5</b> A simple forecast</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="forecasting.html"><a href="forecasting.html#two-step-ahead-forecast"><i class="fa fa-check"></i><b>8.5.1</b> Two-step-ahead forecast</a></li>
<li class="chapter" data-level="8.5.2" data-path="forecasting.html"><a href="forecasting.html#example"><i class="fa fa-check"></i><b>8.5.2</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="forecasting.html"><a href="forecasting.html#using-arma-coefficients-to-forecast"><i class="fa fa-check"></i><b>8.6</b> Using ARMA coefficients to forecast</a></li>
<li class="chapter" data-level="8.7" data-path="forecasting.html"><a href="forecasting.html#holt-winters"><i class="fa fa-check"></i><b>8.7</b> Holt-Winters</a></li>
<li class="chapter" data-level="8.8" data-path="forecasting.html"><a href="forecasting.html#your-work-4"><i class="fa fa-check"></i><b>8.8</b> Your work</a>
<ul>
<li class="chapter" data-level="8.8.1" data-path="forecasting.html"><a href="forecasting.html#a-silly-prediction"><i class="fa fa-check"></i><b>8.8.1</b> A silly prediction</a></li>
<li class="chapter" data-level="8.8.2" data-path="forecasting.html"><a href="forecasting.html#write-up-and-reflect-4"><i class="fa fa-check"></i><b>8.8.2</b> Write Up and Reflect</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="cross-correlation.html"><a href="cross-correlation.html"><i class="fa fa-check"></i><b>9</b> Cross Correlation</a>
<ul>
<li class="chapter" data-level="9.1" data-path="cross-correlation.html"><a href="cross-correlation.html#big-idea-5"><i class="fa fa-check"></i><b>9.1</b> Big Idea</a></li>
<li class="chapter" data-level="9.2" data-path="cross-correlation.html"><a href="cross-correlation.html#reading-5"><i class="fa fa-check"></i><b>9.2</b> Reading</a></li>
<li class="chapter" data-level="9.3" data-path="cross-correlation.html"><a href="cross-correlation.html#packages-5"><i class="fa fa-check"></i><b>9.3</b> Packages</a></li>
<li class="chapter" data-level="9.4" data-path="cross-correlation.html"><a href="cross-correlation.html#lags"><i class="fa fa-check"></i><b>9.4</b> Lags</a></li>
<li class="chapter" data-level="9.5" data-path="cross-correlation.html"><a href="cross-correlation.html#from-acf-to-ccf"><i class="fa fa-check"></i><b>9.5</b> From ACF to CCF</a></li>
<li class="chapter" data-level="9.6" data-path="cross-correlation.html"><a href="cross-correlation.html#how-ccf-normalizes-correlations"><i class="fa fa-check"></i><b>9.6</b> How <code>Ccf()</code> Normalizes Correlations</a></li>
<li class="chapter" data-level="9.7" data-path="cross-correlation.html"><a href="cross-correlation.html#your-work-5"><i class="fa fa-check"></i><b>9.7</b> Your work</a>
<ul>
<li class="chapter" data-level="9.7.1" data-path="cross-correlation.html"><a href="cross-correlation.html#write-up-and-reflect-5"><i class="fa fa-check"></i><b>9.7.1</b> Write Up and Reflect</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="regression.html"><a href="regression.html"><i class="fa fa-check"></i><b>10</b> Regression</a>
<ul>
<li class="chapter" data-level="10.1" data-path="regression.html"><a href="regression.html#big-idea-6"><i class="fa fa-check"></i><b>10.1</b> Big Idea</a></li>
<li class="chapter" data-level="10.2" data-path="regression.html"><a href="regression.html#reading-6"><i class="fa fa-check"></i><b>10.2</b> Reading</a></li>
<li class="chapter" data-level="10.3" data-path="regression.html"><a href="regression.html#packages-6"><i class="fa fa-check"></i><b>10.3</b> Packages</a></li>
<li class="chapter" data-level="10.4" data-path="regression.html"><a href="regression.html#regression-1"><i class="fa fa-check"></i><b>10.4</b> Regression</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="regression.html"><a href="regression.html#adjusting-ols"><i class="fa fa-check"></i><b>10.4.1</b> Adjusting OLS</a></li>
<li class="chapter" data-level="10.4.2" data-path="regression.html"><a href="regression.html#gls"><i class="fa fa-check"></i><b>10.4.2</b> GLS</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="regression.html"><a href="regression.html#your-work-6"><i class="fa fa-check"></i><b>10.5</b> Your work</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="regression.html"><a href="regression.html#what-does-generalized-mean"><i class="fa fa-check"></i><b>10.5.1</b> What Does Generalized Mean?</a></li>
<li class="chapter" data-level="10.5.2" data-path="regression.html"><a href="regression.html#regression-simulation"><i class="fa fa-check"></i><b>10.5.2</b> Regression Simulation</a></li>
<li class="chapter" data-level="10.5.3" data-path="regression.html"><a href="regression.html#regression-for-real"><i class="fa fa-check"></i><b>10.5.3</b> Regression for real</a></li>
<li class="chapter" data-level="10.5.4" data-path="regression.html"><a href="regression.html#write-up-and-reflect-6"><i class="fa fa-check"></i><b>10.5.4</b> Write Up and Reflect</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="filtering-smoothing.html"><a href="filtering-smoothing.html"><i class="fa fa-check"></i><b>11</b> Filtering, smoothing</a>
<ul>
<li class="chapter" data-level="11.1" data-path="filtering-smoothing.html"><a href="filtering-smoothing.html#big-idea-7"><i class="fa fa-check"></i><b>11.1</b> Big Idea</a></li>
<li class="chapter" data-level="11.2" data-path="filtering-smoothing.html"><a href="filtering-smoothing.html#packages-7"><i class="fa fa-check"></i><b>11.2</b> Packages</a></li>
<li class="chapter" data-level="11.3" data-path="filtering-smoothing.html"><a href="filtering-smoothing.html#filters-as-visual-aids"><i class="fa fa-check"></i><b>11.3</b> Filters as visual aids</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="filtering-smoothing.html"><a href="filtering-smoothing.html#moving-running-average"><i class="fa fa-check"></i><b>11.3.1</b> Moving (running) average</a></li>
<li class="chapter" data-level="11.3.2" data-path="filtering-smoothing.html"><a href="filtering-smoothing.html#hanning"><i class="fa fa-check"></i><b>11.3.2</b> Hanning</a></li>
<li class="chapter" data-level="11.3.3" data-path="filtering-smoothing.html"><a href="filtering-smoothing.html#smoothing-splines"><i class="fa fa-check"></i><b>11.3.3</b> Smoothing splines</a></li>
<li class="chapter" data-level="11.3.4" data-path="filtering-smoothing.html"><a href="filtering-smoothing.html#loess"><i class="fa fa-check"></i><b>11.3.4</b> Loess</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="filtering-smoothing.html"><a href="filtering-smoothing.html#using-filters"><i class="fa fa-check"></i><b>11.4</b> Using filters</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="filtering-smoothing.html"><a href="filtering-smoothing.html#aggregating"><i class="fa fa-check"></i><b>11.4.1</b> Aggregating</a></li>
<li class="chapter" data-level="11.4.2" data-path="filtering-smoothing.html"><a href="filtering-smoothing.html#removing-low-frequency-variability"><i class="fa fa-check"></i><b>11.4.2</b> Removing low frequency variability</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="filtering-smoothing.html"><a href="filtering-smoothing.html#the-case-of-the-poorly-launched-sensors"><i class="fa fa-check"></i><b>11.5</b> The Case of the Poorly-Launched Sensors</a>
<ul>
<li class="chapter" data-level="11.5.1" data-path="filtering-smoothing.html"><a href="filtering-smoothing.html#fix-time-on-temperature"><i class="fa fa-check"></i><b>11.5.1</b> Fix time on temperature</a></li>
<li class="chapter" data-level="11.5.2" data-path="filtering-smoothing.html"><a href="filtering-smoothing.html#fill-missing-data-on-radiation"><i class="fa fa-check"></i><b>11.5.2</b> Fill missing data on radiation</a></li>
</ul></li>
<li class="chapter" data-level="11.6" data-path="filtering-smoothing.html"><a href="filtering-smoothing.html#your-work-7"><i class="fa fa-check"></i><b>11.6</b> Your work</a>
<ul>
<li class="chapter" data-level="11.6.1" data-path="filtering-smoothing.html"><a href="filtering-smoothing.html#filter"><i class="fa fa-check"></i><b>11.6.1</b> Filter</a></li>
<li class="chapter" data-level="11.6.2" data-path="filtering-smoothing.html"><a href="filtering-smoothing.html#revisit-the-case-of-the-poorly-launched-sensors"><i class="fa fa-check"></i><b>11.6.2</b> Revisit the case of the poorly launched sensors</a></li>
<li class="chapter" data-level="11.6.3" data-path="filtering-smoothing.html"><a href="filtering-smoothing.html#write-up-and-reflect-7"><i class="fa fa-check"></i><b>11.6.3</b> Write Up and Reflect</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="the-freqs-come-out-at-night.html"><a href="the-freqs-come-out-at-night.html"><i class="fa fa-check"></i><b>12</b> The Freqs Come out at Night</a>
<ul>
<li class="chapter" data-level="12.1" data-path="the-freqs-come-out-at-night.html"><a href="the-freqs-come-out-at-night.html#big-idea-8"><i class="fa fa-check"></i><b>12.1</b> Big Idea</a></li>
<li class="chapter" data-level="12.2" data-path="the-freqs-come-out-at-night.html"><a href="the-freqs-come-out-at-night.html#reading-7"><i class="fa fa-check"></i><b>12.2</b> Reading</a></li>
<li class="chapter" data-level="12.3" data-path="the-freqs-come-out-at-night.html"><a href="the-freqs-come-out-at-night.html#packages-8"><i class="fa fa-check"></i><b>12.3</b> Packages</a></li>
<li class="chapter" data-level="12.4" data-path="the-freqs-come-out-at-night.html"><a href="the-freqs-come-out-at-night.html#the-frequency-domain"><i class="fa fa-check"></i><b>12.4</b> The Frequency Domain</a>
<ul>
<li class="chapter" data-level="12.4.1" data-path="the-freqs-come-out-at-night.html"><a href="the-freqs-come-out-at-night.html#same-data-two-domains"><i class="fa fa-check"></i><b>12.4.1</b> Same Data, Two Domains</a></li>
<li class="chapter" data-level="12.4.2" data-path="the-freqs-come-out-at-night.html"><a href="the-freqs-come-out-at-night.html#worked-example"><i class="fa fa-check"></i><b>12.4.2</b> Worked example</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="the-freqs-come-out-at-night.html"><a href="the-freqs-come-out-at-night.html#sunspot-example"><i class="fa fa-check"></i><b>12.5</b> Sunspot Example</a></li>
<li class="chapter" data-level="12.6" data-path="the-freqs-come-out-at-night.html"><a href="the-freqs-come-out-at-night.html#your-work-8"><i class="fa fa-check"></i><b>12.6</b> Your work</a>
<ul>
<li class="chapter" data-level="12.6.1" data-path="the-freqs-come-out-at-night.html"><a href="the-freqs-come-out-at-night.html#generate-three-signals"><i class="fa fa-check"></i><b>12.6.1</b> Generate three signals</a></li>
<li class="chapter" data-level="12.6.2" data-path="the-freqs-come-out-at-night.html"><a href="the-freqs-come-out-at-night.html#milankovitch"><i class="fa fa-check"></i><b>12.6.2</b> Milankovitch</a></li>
<li class="chapter" data-level="12.6.3" data-path="the-freqs-come-out-at-night.html"><a href="the-freqs-come-out-at-night.html#write-up-and-reflect-8"><i class="fa fa-check"></i><b>12.6.3</b> Write Up and Reflect</a></li>
</ul></li>
<li class="chapter" data-level="12.7" data-path="the-freqs-come-out-at-night.html"><a href="the-freqs-come-out-at-night.html#references"><i class="fa fa-check"></i><b>12.7</b> References</a></li>
<li class="chapter" data-level="12.8" data-path="the-freqs-come-out-at-night.html"><a href="the-freqs-come-out-at-night.html#postscript-a-glimpse-of-wavelets"><i class="fa fa-check"></i><b>12.8</b> Postscript: A Glimpse of Wavelets</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="references-1.html"><a href="references-1.html"><i class="fa fa-check"></i><b>13</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">A collection of note for ESCI 504</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="forecasting" class="section level1 hasAnchor" number="8">
<h1><span class="header-section-number">8</span> Forecasting<a href="forecasting.html#forecasting" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="big-idea-4" class="section level2 hasAnchor" number="8.1">
<h2><span class="header-section-number">8.1</span> Big Idea<a href="forecasting.html#big-idea-4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The correlation structure of a time series itself can often be enough to forecast it for a short time.</p>
</div>
<div id="reading-4" class="section level2 hasAnchor" number="8.2">
<h2><span class="header-section-number">8.2</span> Reading<a href="forecasting.html#reading-4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Have a look at Chapter three from <span class="citation">Cowpertwait and Metcalfe (<a href="references-1.html#ref-Cowpertwait2009">2009</a>)</span>. It’s OK to skim the readings in this book. It’s not a great book for our purposes as many of you haven’t taken linear algebra and the book occasionally goes that way. But it’s useful to hum your way through the chapter nonetheless.</p>
</div>
<div id="packages-4" class="section level2 hasAnchor" number="8.3">
<h2><span class="header-section-number">8.3</span> Packages<a href="forecasting.html#packages-4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>You’ll want the <code>forecast</code> <span class="citation">(<a href="references-1.html#ref-R-forecast">Hyndman et al. 2025</a>)</span> library. And <code>tidyverse</code> <span class="citation">(<a href="references-1.html#ref-R-tidyverse">Wickham 2023</a>)</span> naturally.</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="forecasting.html#cb183-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb183-2"><a href="forecasting.html#cb183-2" tabindex="-1"></a><span class="fu">library</span>(forecast)</span></code></pre></div>
</div>
<div id="introduction-1" class="section level2 hasAnchor" number="8.4">
<h2><span class="header-section-number">8.4</span> Introduction<a href="forecasting.html#introduction-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>There are entire books written about forecasting time series data and many of them are financial in nature. (You would do well to quit the environmental world, make a lot of money in finance, and then make a nice donation to the University with “ESCI 504” written on the memo line of the check.) The idea is that you can use the properties of the time series itself to forecast it over a short period. If the series has enough temporal structure you can likely predict it (albeit with some error) for some short time period. I have to confess that I’ve never had to do any serious time series forecasting in my own research. I’m interested in describing and accounting for temporal structure as a way of understanding mechanism more than I am in predicting values. I did work with a grad student a few years ago who wanted to forecast river flow from temperature and precipitation records. We found that a time series forecast worked pretty well and sometimes better than using exogenous predictors. So, even if you can’t make a trillion bucks forecasting environmental data, you should pay attention.</p>
</div>
<div id="a-simple-forecast" class="section level2 hasAnchor" number="8.5">
<h2><span class="header-section-number">8.5</span> A simple forecast<a href="forecasting.html#a-simple-forecast" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s imagine an AR(1) model and show how we can forecast it using <span class="math inline">\(y_{t-1}\)</span> and <span class="math inline">\(\phi\)</span> to model <span class="math inline">\(y_t\)</span>.</p>
<p>Suppose we have a model:</p>
<p><span class="math display">\[
y_t = \phi y_{t-1} + \epsilon_t
\]</span></p>
<p>where <span class="math inline">\(\phi = 0.7\)</span> and <span class="math inline">\(\epsilon_t \sim \mathcal{N}(0, 1)\)</span>.</p>
<p>If we know the current value <span class="math inline">\(y_t\)</span>, we can forecast the next value <span class="math inline">\(y_{t+1}\)</span> as:</p>
<p><span class="math display">\[
\hat{y}_{t+1} = \phi y_t = 0.7 \times y_t
\]</span></p>
<p>Since this is a one-step-ahead forecast, the expected value of the error term <span class="math inline">\(\epsilon_{t+1}\)</span> is zero, so our best forecast is just the deterministic part.</p>
<p>However, that forecast has some uncertainty associated with it that we can model as well. The forecast error is defined as:</p>
<p><span class="math display">\[
e_{t+1} = y_{t+1} - \hat{y}_{t+1} = \phi y_t + \epsilon_{t+1} - \phi y_t = \epsilon_{t+1}
\]</span></p>
<p>So the one-step-ahead forecast error has variance:</p>
<p><span class="math display">\[
\text{Var}(e_{t+1}) = \text{Var}(\epsilon_{t+1}) = 1
\]</span></p>
<p>This means our forecast is unbiased, but there is always a ±1 SD range of uncertainty.</p>
<div id="two-step-ahead-forecast" class="section level3 hasAnchor" number="8.5.1">
<h3><span class="header-section-number">8.5.1</span> Two-step-ahead forecast<a href="forecasting.html#two-step-ahead-forecast" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To forecast two steps ahead, we use our prediction for <span class="math inline">\(y_{t+1}\)</span> to forecast <span class="math inline">\(y_{t+2}\)</span>. The true value is:</p>
<p><span class="math display">\[
y_{t+2} = \phi y_{t+1} + \epsilon_{t+2}
\]</span></p>
<p>We don’t know <span class="math inline">\(y_{t+1}\)</span>, but we can plug in our forecast:</p>
<p><span class="math display">\[
\hat{y}_{t+2} = \phi \hat{y}_{t+1} = \phi^2 y_t
\]</span></p>
<p>This is the best guess based on information available at time <span class="math inline">\(t\)</span>. But now there are two sources of uncertainty: the new shock <span class="math inline">\(\epsilon_{t+2}\)</span>, and the fact that <span class="math inline">\(y_{t+1}\)</span> itself was only an estimate. When we expand the expression for <span class="math inline">\(y_{t+2}\)</span>, we get:</p>
<p><span class="math display">\[
y_{t+2} = \phi (\phi y_t + \epsilon_{t+1}) + \epsilon_{t+2} = \phi^2 y_t + \phi \epsilon_{t+1} + \epsilon_{t+2}
\]</span></p>
<p>So the two-step-ahead forecast error is:</p>
<p><span class="math display">\[
e_{t+2} = y_{t+2} - \hat{y}_{t+2} = \phi \epsilon_{t+1} + \epsilon_{t+2}
\]</span></p>
<p>And the variance of this error is:</p>
<p><span class="math display">\[
\text{Var}(e_{t+2}) = \phi^2 \text{Var}(\epsilon_{t+1}) + \text{Var}(\epsilon_{t+2}) = \phi^2 + 1
\]</span></p>
<p>With <span class="math inline">\(\phi = 0.7\)</span>, that gives:</p>
<p><span class="math display">\[
\text{Var}(e_{t+2}) = (0.7)^2 + 1 = 0.49 + 1 = 1.49
\]</span></p>
<p>So, while the one-step-ahead forecast has a variance of 1, the two-step-ahead forecast has a higher variance of 1.49. This increase reflects the compounding uncertainty as we project further into the future.</p>
<p>And you can foresee that if you want to forecast three steps out, the variance would increase again as additional error terms enter the expression, each scaled by a power of <span class="math inline">\(\phi\)</span>. The forecast error would include <span class="math inline">\(\phi^2 \epsilon_{t+1} + \phi \epsilon_{t+2} + \epsilon_{t+3}\)</span>, and its variance would be:</p>
<p><span class="math display">\[
\text{Var}(e_{t+3}) = \phi^4 + \phi^2 + 1
\]</span></p>
<p>In general, for an <span class="math inline">\(k\)</span>-step-ahead forecast in an AR(1) model with white noise variance <span class="math inline">\(\sigma^2\)</span>, the forecast error variance is:</p>
<p><span class="math display">\[
\text{Var}(e_{t+k}) = \sigma^2 \sum_{j=0}^{k-1} \phi^{2j}
\]</span></p>
<p>This is a geometric series, and if <span class="math inline">\(|\phi| &lt; 1\)</span>, it converges to:</p>
<p><span class="math display">\[
\lim_{k \to \infty} \text{Var}(e_{t+k}) = \frac{\sigma^2}{1 - \phi^2}
\]</span></p>
<p>So even though uncertainty grows with forecast horizon, it levels off to a fixed upper bound when the process is stationary. Recall how the ACF function in an AR(1) trailed off geometrically? This is the same idea.</p>
</div>
<div id="example" class="section level3 hasAnchor" number="8.5.2">
<h3><span class="header-section-number">8.5.2</span> Example<a href="forecasting.html#example" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let’s show this in a simple simulation. Below, we use the last observed value <span class="math inline">\(y_t\)</span> to generate a one-step-ahead forecast:</p>
<p><span class="math display">\[
\hat{y}_{t+1} = \phi y_t
\]</span></p>
<p>Then, we use this forecasted value to produce a two-step-ahead forecast:</p>
<p><span class="math display">\[
\hat{y}_{t+2} = \phi \hat{y}_{t+1}
\]</span></p>
<p>and so on. This is called <strong>chained forecasting</strong>, and it mimics what we would do in practice when future values are unknown. While each step uses the same rule, the uncertainty compounds because each forecast depends on previous estimates rather than actual values.</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="forecasting.html#cb184-1" tabindex="-1"></a><span class="co"># Simulate an AR(1) process and do chained forecasting</span></span>
<span id="cb184-2"><a href="forecasting.html#cb184-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">62</span>)  <span class="co"># for reproducibility</span></span>
<span id="cb184-3"><a href="forecasting.html#cb184-3" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb184-4"><a href="forecasting.html#cb184-4" tabindex="-1"></a>phi <span class="ot">&lt;-</span> <span class="fl">0.7</span></span>
<span id="cb184-5"><a href="forecasting.html#cb184-5" tabindex="-1"></a>epsilon <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb184-6"><a href="forecasting.html#cb184-6" tabindex="-1"></a></span>
<span id="cb184-7"><a href="forecasting.html#cb184-7" tabindex="-1"></a><span class="co"># Generate the AR(1) series</span></span>
<span id="cb184-8"><a href="forecasting.html#cb184-8" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)</span>
<span id="cb184-9"><a href="forecasting.html#cb184-9" tabindex="-1"></a>y[<span class="dv">1</span>] <span class="ot">&lt;-</span> epsilon[<span class="dv">1</span>]</span>
<span id="cb184-10"><a href="forecasting.html#cb184-10" tabindex="-1"></a></span>
<span id="cb184-11"><a href="forecasting.html#cb184-11" tabindex="-1"></a><span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>n) {</span>
<span id="cb184-12"><a href="forecasting.html#cb184-12" tabindex="-1"></a>  y[t] <span class="ot">&lt;-</span> phi <span class="sc">*</span> y[t <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span> epsilon[t]</span>
<span id="cb184-13"><a href="forecasting.html#cb184-13" tabindex="-1"></a>}</span>
<span id="cb184-14"><a href="forecasting.html#cb184-14" tabindex="-1"></a></span>
<span id="cb184-15"><a href="forecasting.html#cb184-15" tabindex="-1"></a><span class="co"># Last observed value</span></span>
<span id="cb184-16"><a href="forecasting.html#cb184-16" tabindex="-1"></a>y_t <span class="ot">&lt;-</span> y[n]</span>
<span id="cb184-17"><a href="forecasting.html#cb184-17" tabindex="-1"></a></span>
<span id="cb184-18"><a href="forecasting.html#cb184-18" tabindex="-1"></a><span class="co"># Forecasts</span></span>
<span id="cb184-19"><a href="forecasting.html#cb184-19" tabindex="-1"></a>y_hat_1 <span class="ot">&lt;-</span> phi <span class="sc">*</span> y_t                    <span class="co"># one-step-ahead</span></span>
<span id="cb184-20"><a href="forecasting.html#cb184-20" tabindex="-1"></a>y_hat_2 <span class="ot">&lt;-</span> phi <span class="sc">*</span> y_hat_1                <span class="co"># two-step-ahead (chained)</span></span>
<span id="cb184-21"><a href="forecasting.html#cb184-21" tabindex="-1"></a>y_hat_3 <span class="ot">&lt;-</span> phi <span class="sc">*</span> y_hat_2                <span class="co"># three-step-ahead (chained)</span></span>
<span id="cb184-22"><a href="forecasting.html#cb184-22" tabindex="-1"></a></span>
<span id="cb184-23"><a href="forecasting.html#cb184-23" tabindex="-1"></a><span class="co"># Forecast SDs (1, phi^2 + 1, phi^4 + phi^2 + 1)</span></span>
<span id="cb184-24"><a href="forecasting.html#cb184-24" tabindex="-1"></a>se_1 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb184-25"><a href="forecasting.html#cb184-25" tabindex="-1"></a>se_2 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(phi<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb184-26"><a href="forecasting.html#cb184-26" tabindex="-1"></a>se_3 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(phi<span class="sc">^</span><span class="dv">4</span> <span class="sc">+</span> phi<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="05TimeSeries-Forecast_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
</div>
</div>
<div id="using-arma-coefficients-to-forecast" class="section level2 hasAnchor" number="8.6">
<h2><span class="header-section-number">8.6</span> Using ARMA coefficients to forecast<a href="forecasting.html#using-arma-coefficients-to-forecast" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Now that we get the idea, let’s work on a more sophisticated example using the fitted coefficients from an AR model. That is, we will build on our experience and use just the internal autocorrelation of a time series to forecast a few steps forward. Doing so is more interesting given stronger and longer memory processes. Thus, we will take the data of annual sunspot counts which you’ll recall vary over about a decade and forecast the time series.</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="forecasting.html#cb185-1" tabindex="-1"></a><span class="fu">data</span>(sunspot.year)</span>
<span id="cb185-2"><a href="forecasting.html#cb185-2" tabindex="-1"></a><span class="fu">autoplot</span>(sunspot.year) <span class="sc">+</span></span>
<span id="cb185-3"><a href="forecasting.html#cb185-3" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;Year&quot;</span>, <span class="at">y =</span><span class="st">&quot;Sunspots (n)&quot;</span>) <span class="sc">+</span> </span>
<span id="cb185-4"><a href="forecasting.html#cb185-4" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="05TimeSeries-Forecast_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>Until now we have been fitting AR and ARMA “by hand.” We’ve been thinking about the models and deciding on the order based on ACF, PACF, AIC, etc. That is the smart way of doing things. It makes you think about the models, the processes, and so on. But some of you have already discovered the the <code>ar</code> and <code>auto.arima</code> functions which simplify this process (dangerously so<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a>). The later is in the <code>forecast</code> library. Here we will use <code>ar</code> to fit an AR(<span class="math inline">\(p\)</span>) model and <span class="math inline">\(p\)</span> will be selected for us magically (actually by AIC).</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="forecasting.html#cb186-1" tabindex="-1"></a>sunspot.ar <span class="ot">&lt;-</span> <span class="fu">ar</span>(sunspot.year)</span>
<span id="cb186-2"><a href="forecasting.html#cb186-2" tabindex="-1"></a>sunspot.ar</span></code></pre></div>
<pre><code>## 
## Call:
## ar(x = sunspot.year)
## 
## Coefficients:
##       1        2        3        4        5        6        7        8  
##  1.1305  -0.3524  -0.1745   0.1403  -0.1358   0.0963  -0.0556   0.0076  
##       9  
##  0.1941  
## 
## Order selected 9  sigma^2 estimated as  267.5</code></pre>
<p>Note the the class of the <code>sunspot.ar</code> object and think about methods. Most models have a <code>predict</code> method. So, now that we have the AR(9) model for the sunspots we can predict sunspots out a few years.</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="forecasting.html#cb188-1" tabindex="-1"></a>sunspot.forecast <span class="ot">&lt;-</span> <span class="fu">predict</span>(sunspot.ar, <span class="at">n.ahead =</span> <span class="dv">10</span>)</span>
<span id="cb188-2"><a href="forecasting.html#cb188-2" tabindex="-1"></a><span class="fu">plot</span>(sunspot.year,<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">1700</span>, <span class="dv">1998</span>),<span class="at">col=</span><span class="st">&quot;grey&quot;</span>,<span class="at">lwd=</span><span class="fl">1.5</span>, </span>
<span id="cb188-3"><a href="forecasting.html#cb188-3" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">&quot;Sunspots (n)&quot;</span>)</span>
<span id="cb188-4"><a href="forecasting.html#cb188-4" tabindex="-1"></a><span class="fu">lines</span>(sunspot.forecast<span class="sc">$</span>pred,<span class="at">col=</span><span class="st">&quot;darkgreen&quot;</span>,<span class="at">lwd=</span><span class="fl">1.5</span>)</span></code></pre></div>
<p><img src="05TimeSeries-Forecast_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>This is pretty cool. The sunspot data fit an AR(9) process and the <code>predict</code> function (look at <code>?predict.ar</code>) captures the cyclic nature of the sunspot data. Let’s make a better plot by zooming in a little and adding the standard error of the forecast to the plot. I’ll go <code>ggplot</code> for this one.</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="forecasting.html#cb189-1" tabindex="-1"></a>forecast_tb <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">index =</span> <span class="fu">time</span>(sunspot.forecast<span class="sc">$</span>pred),</span>
<span id="cb189-2"><a href="forecasting.html#cb189-2" tabindex="-1"></a>                      <span class="at">yhat =</span> sunspot.forecast<span class="sc">$</span>pred,</span>
<span id="cb189-3"><a href="forecasting.html#cb189-3" tabindex="-1"></a>                      <span class="at">lower =</span> sunspot.forecast<span class="sc">$</span>pred <span class="sc">-</span> sunspot.forecast<span class="sc">$</span>se,</span>
<span id="cb189-4"><a href="forecasting.html#cb189-4" tabindex="-1"></a>                      <span class="at">upper =</span> sunspot.forecast<span class="sc">$</span>pred <span class="sc">+</span> sunspot.forecast<span class="sc">$</span>se)</span>
<span id="cb189-5"><a href="forecasting.html#cb189-5" tabindex="-1"></a></span>
<span id="cb189-6"><a href="forecasting.html#cb189-6" tabindex="-1"></a>obs_tb <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">tidy</span>(sunspot.year) <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">y =</span> value)   </span>
<span id="cb189-7"><a href="forecasting.html#cb189-7" tabindex="-1"></a></span>
<span id="cb189-8"><a href="forecasting.html#cb189-8" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb189-9"><a href="forecasting.html#cb189-9" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> obs_tb,<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x=</span>index,<span class="at">y=</span>y)) <span class="sc">+</span></span>
<span id="cb189-10"><a href="forecasting.html#cb189-10" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> forecast_tb,</span>
<span id="cb189-11"><a href="forecasting.html#cb189-11" tabindex="-1"></a>              <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x=</span>index,<span class="at">ymin=</span>lower, <span class="at">ymax=</span>upper),</span>
<span id="cb189-12"><a href="forecasting.html#cb189-12" tabindex="-1"></a>              <span class="at">fill=</span><span class="st">&quot;darkgreen&quot;</span>,<span class="at">alpha=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb189-13"><a href="forecasting.html#cb189-13" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> forecast_tb,</span>
<span id="cb189-14"><a href="forecasting.html#cb189-14" tabindex="-1"></a>            <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x=</span>index,<span class="at">y=</span>yhat),</span>
<span id="cb189-15"><a href="forecasting.html#cb189-15" tabindex="-1"></a>            <span class="at">col=</span><span class="st">&quot;darkgreen&quot;</span>) <span class="sc">+</span></span>
<span id="cb189-16"><a href="forecasting.html#cb189-16" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;Sunspots (n)&quot;</span>,<span class="at">x=</span><span class="st">&quot;Year&quot;</span>) <span class="sc">+</span></span>
<span id="cb189-17"><a href="forecasting.html#cb189-17" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">1950</span>,<span class="dv">1998</span>))</span></code></pre></div>
<pre><code>## Warning: Removed 250 rows containing missing values or values outside the scale range
## (`geom_line()`).</code></pre>
<p><img src="05TimeSeries-Forecast_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>But what would happen if we extended this forward? Where will the predictions go? What about the errors?</p>
</div>
<div id="holt-winters" class="section level2 hasAnchor" number="8.7">
<h2><span class="header-section-number">8.7</span> Holt-Winters<a href="forecasting.html#holt-winters" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We’ve already worked with data containing <em>seasonality</em> and a <em>trend</em>. E.g., the CO<span class="math inline">\(_2\)</span> data you’ve used when you were decomposing time series back towards the start of class. Forecasting this kind of data is more involved than the AR or ARMA approach we used above. Recall <em>stationarity</em>? The Holt-Winters algorithm is a way forward. The book has an excellent explanation of the theory behind it. I’m not going to walk you through all of it but I want to explain, to some extent, the idea behind exponential smoothing. In simplest terms, exponential smoothing is a weighted average where points that are immediately back in time affect the predicted value more than points that are further back in time.</p>
<p>Any time you want to forecast (predict), you need a model. Holt-Winters uses triple exponential smoothing to estimate <span class="math inline">\(\hat y_{t+1}\)</span> as a function of past values of <span class="math inline">\(y_t\)</span>. The triple part means that Holt Winters applies the exponential smoothing concept to the 1) trend, 2) season, and 3) residuals. So let’s look at what exponential smoothing is.</p>
<p>But we can start to unpack exponential smoothing much more simply using averages and moving averages. We’ve talked about kind of stuff a little but this is a good chance to get further into it.</p>
<p>Let’s think about this with some code. Below we have a time series <span class="math inline">\(y_t\)</span> with seven values and we will use those past values to predict the 8th value.</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="forecasting.html#cb191-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span></span>
<span id="cb191-2"><a href="forecasting.html#cb191-2" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">8</span>,<span class="dv">5</span>,<span class="dv">12</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">9</span>,<span class="dv">19</span>)</span>
<span id="cb191-3"><a href="forecasting.html#cb191-3" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>y)) <span class="sc">+</span> </span>
<span id="cb191-4"><a href="forecasting.html#cb191-4" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb191-5"><a href="forecasting.html#cb191-5" tabindex="-1"></a>  <span class="fu">lims</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">9</span>))</span>
<span id="cb191-6"><a href="forecasting.html#cb191-6" tabindex="-1"></a>p1</span></code></pre></div>
<p><img src="05TimeSeries-Forecast_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>If I want to estimate <span class="math inline">\(\hat y_8\)</span> we could start with a simple average. The idea is that if <span class="math inline">\(y\)</span> is a random variable it will have a central tenancy so forecasting it to the mean is kind of reasonable, right? So we will assume that <span class="math inline">\(\hat y_8 = \bar y\)</span> and add it to the plot.</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="forecasting.html#cb192-1" tabindex="-1"></a>yhat1 <span class="ot">&lt;-</span> <span class="fu">mean</span>(y)</span>
<span id="cb192-2"><a href="forecasting.html#cb192-2" tabindex="-1"></a>yhat1</span></code></pre></div>
<pre><code>## [1] 10.85714</code></pre>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="forecasting.html#cb194-1" tabindex="-1"></a>p1 <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x=</span><span class="dv">8</span>,<span class="at">y=</span>yhat1),<span class="at">color=</span><span class="st">&quot;blue&quot;</span>,<span class="at">size=</span><span class="dv">3</span>)</span></code></pre></div>
<p><img src="05TimeSeries-Forecast_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>We can also use moving averages to get just a tiny bit more sophisticated. You used these some when we were reading and plotting data. Recall the <code>filter</code> and <code>rollmean</code> functions? Let’s roll our own but in this case we won’t roll the function along the length of <span class="math inline">\(y\)</span> but just select how many points back in time to use to estimate <span class="math inline">\(\hat y_8\)</span> :</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="forecasting.html#cb195-1" tabindex="-1"></a>maFunc <span class="ot">&lt;-</span> <span class="cf">function</span>(x,<span class="at">n=</span><span class="dv">2</span>){</span>
<span id="cb195-2"><a href="forecasting.html#cb195-2" tabindex="-1"></a>  nx <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb195-3"><a href="forecasting.html#cb195-3" tabindex="-1"></a>  <span class="fu">mean</span>(x[(nx<span class="sc">-</span>n<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>nx])</span>
<span id="cb195-4"><a href="forecasting.html#cb195-4" tabindex="-1"></a>}</span>
<span id="cb195-5"><a href="forecasting.html#cb195-5" tabindex="-1"></a>yhat2 <span class="ot">&lt;-</span> <span class="fu">maFunc</span>(y,<span class="at">n=</span><span class="dv">4</span>) <span class="co"># 4 point</span></span>
<span id="cb195-6"><a href="forecasting.html#cb195-6" tabindex="-1"></a>yhat2</span></code></pre></div>
<pre><code>## [1] 12.75</code></pre>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="forecasting.html#cb197-1" tabindex="-1"></a>p1 <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x=</span><span class="dv">8</span>,<span class="at">y=</span>yhat2),<span class="at">color=</span><span class="st">&quot;blue&quot;</span>,<span class="at">size=</span><span class="dv">3</span>)</span></code></pre></div>
<p><img src="05TimeSeries-Forecast_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>I know some of you are already programming quite a bit and have asked questions about how to write functions. Feel free to ignore if this doesn’t interest you. I’ll slip a little code snippet in here here so that if we set <code>n</code> to <code>NULL</code> we will just get the average.</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="forecasting.html#cb198-1" tabindex="-1"></a>maFunc <span class="ot">&lt;-</span> <span class="cf">function</span>(x,<span class="at">n=</span><span class="dv">2</span>){</span>
<span id="cb198-2"><a href="forecasting.html#cb198-2" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.null</span>(n)) { <span class="fu">mean</span>(x) }</span>
<span id="cb198-3"><a href="forecasting.html#cb198-3" tabindex="-1"></a>  <span class="cf">else</span>{</span>
<span id="cb198-4"><a href="forecasting.html#cb198-4" tabindex="-1"></a>    nx <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb198-5"><a href="forecasting.html#cb198-5" tabindex="-1"></a>    <span class="fu">mean</span>(x[(nx<span class="sc">-</span>n<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>nx])</span>
<span id="cb198-6"><a href="forecasting.html#cb198-6" tabindex="-1"></a>  }</span>
<span id="cb198-7"><a href="forecasting.html#cb198-7" tabindex="-1"></a>}</span>
<span id="cb198-8"><a href="forecasting.html#cb198-8" tabindex="-1"></a><span class="fu">maFunc</span>(y,<span class="at">n=</span><span class="cn">NULL</span>)</span></code></pre></div>
<pre><code>## [1] 10.85714</code></pre>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="forecasting.html#cb200-1" tabindex="-1"></a><span class="co"># aka mean(y)</span></span></code></pre></div>
<p>OK, back to work. Note that while we think about averages, moving or otherwise, we usually calculate it as the sum of the values divided by the number of values. E.g., <code>sum(x)/length(x)</code>. For the three point moving average that would calculate <span class="math inline">\(y_8\)</span> this would look like:</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="forecasting.html#cb201-1" tabindex="-1"></a><span class="fu">sum</span>(y[<span class="dv">5</span><span class="sc">:</span><span class="dv">7</span>]) <span class="sc">/</span> <span class="dv">3</span></span></code></pre></div>
<pre><code>## [1] 13.33333</code></pre>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="forecasting.html#cb203-1" tabindex="-1"></a><span class="co"># aka</span></span>
<span id="cb203-2"><a href="forecasting.html#cb203-2" tabindex="-1"></a><span class="fu">maFunc</span>(y,<span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] 13.33333</code></pre>
<p>An algebraic thing that you might not have considered is that we can so the same thing as:</p>
<p><span class="math display">\[\hat y_8 = y_5 \times \frac{1}{3} + y_6 \times \frac{1}{3} + y_7 \times \frac{1}{3}\]</span></p>
<p>Or</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="forecasting.html#cb205-1" tabindex="-1"></a><span class="fu">sum</span>(y[<span class="dv">5</span>]<span class="sc">*</span><span class="fl">0.333</span> <span class="sc">+</span> y[<span class="dv">6</span>]<span class="sc">*</span><span class="fl">0.333</span> <span class="sc">+</span> y[<span class="dv">7</span>]<span class="sc">*</span><span class="fl">0.333</span>)</span></code></pre></div>
<pre><code>## [1] 13.32</code></pre>
<p>That is, we are moving the denominator up and multiplying each value by <span class="math inline">\(1/3\)</span>. This gets the same answer and treats all observations for calculating the average the same way. Those three values are weighted evenly. However, we can also add weights to the average. You’ve done this at some point in your careers. The idea is to make some points have more influence. In time series this is almost always done to make more recent values matter more in the average.</p>
<p>Thus we can supply a vector of weights, <code>w</code>, that sum to one that will affect the way the average is calculated. The length of <code>w</code> will be the length of the moving average and the weights will reflect the relative importance of that observations.For example here is a weighted moving average of 4 with 10%, 20%, 30% and 40% given to those last 4 points.</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="forecasting.html#cb207-1" tabindex="-1"></a>wmaFunc <span class="ot">&lt;-</span> <span class="cf">function</span>(x,w){</span>
<span id="cb207-2"><a href="forecasting.html#cb207-2" tabindex="-1"></a>  nx <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb207-3"><a href="forecasting.html#cb207-3" tabindex="-1"></a>  nw <span class="ot">&lt;-</span> <span class="fu">length</span>(w)</span>
<span id="cb207-4"><a href="forecasting.html#cb207-4" tabindex="-1"></a>  <span class="fu">sum</span>(x[(nx<span class="sc">-</span>nw<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>nx] <span class="sc">*</span> w)</span>
<span id="cb207-5"><a href="forecasting.html#cb207-5" tabindex="-1"></a>}</span>
<span id="cb207-6"><a href="forecasting.html#cb207-6" tabindex="-1"></a>yhat3 <span class="ot">&lt;-</span> <span class="fu">wmaFunc</span>(y,<span class="at">w=</span><span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.2</span>,<span class="fl">0.3</span>,<span class="fl">0.4</span>))</span>
<span id="cb207-7"><a href="forecasting.html#cb207-7" tabindex="-1"></a>yhat3</span></code></pre></div>
<pre><code>## [1] 13.8</code></pre>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="forecasting.html#cb209-1" tabindex="-1"></a>p1 <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x=</span><span class="dv">8</span>,<span class="at">y=</span>yhat3),<span class="at">color=</span><span class="st">&quot;blue&quot;</span>,<span class="at">size=</span><span class="dv">3</span>)</span></code></pre></div>
<p><img src="05TimeSeries-Forecast_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<p>So above we are estimating the 8th value of <span class="math inline">\(y\)</span> using the four prior values where each is value is weighted:</p>
<p><span class="math display">\[\hat y_8 = y_4 \times 0.1 + y_5 \times 0.2 + y_6 \times 0.3 + y_7 \times 0.4\]</span></p>
<p>Note that for this to make sense, the weights adding up to 1. If you used weights like 0.9, 0.8, 0.7, 0.6 (which add up to 3.0) you’d get something ridiculous for the estimate If you were programming defensively you’d add a check to the top of <code>wmaFunc</code> to make sure the argument <code>w</code> summed to one. Again ignore this if you like:</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="forecasting.html#cb210-1" tabindex="-1"></a>wmaFunc <span class="ot">&lt;-</span> <span class="cf">function</span>(x,w){</span>
<span id="cb210-2"><a href="forecasting.html#cb210-2" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">isTRUE</span>(<span class="fu">all.equal</span>(<span class="fu">sum</span>(w),<span class="dv">1</span>,<span class="at">tolerance =</span> <span class="fl">0.01</span>))) {<span class="fu">stop</span>(<span class="st">&quot;w must sum to 1&quot;</span>)}</span>
<span id="cb210-3"><a href="forecasting.html#cb210-3" tabindex="-1"></a>  nx <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb210-4"><a href="forecasting.html#cb210-4" tabindex="-1"></a>  nw <span class="ot">&lt;-</span> <span class="fu">length</span>(w)</span>
<span id="cb210-5"><a href="forecasting.html#cb210-5" tabindex="-1"></a>  <span class="fu">sum</span>(x[(nx<span class="sc">-</span>nw<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>nx] <span class="sc">*</span> w)</span>
<span id="cb210-6"><a href="forecasting.html#cb210-6" tabindex="-1"></a>}</span></code></pre></div>
<p>Understanding weights in general is a pretty fundamental skill and especially important for what we are going to do next. Take some time to make sure you follow the concept. Oh, and recall the <code>filter</code> function? We just recreated some of what it does. Look at the help page for filter and see if you see how this ties together note the last non-<code>NA</code> values from this call to <code>filter</code>. Because the base <code>filter</code> function conflicts with dplyr’s <code>filter</code> we will call <code>stats::filter</code> explicitly.</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="forecasting.html#cb211-1" tabindex="-1"></a><span class="fu">wmaFunc</span>(y,<span class="at">w=</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>,<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>,<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>))</span></code></pre></div>
<pre><code>## [1] 13.33333</code></pre>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="forecasting.html#cb213-1" tabindex="-1"></a>stats<span class="sc">::</span><span class="fu">filter</span>(y,<span class="at">filter =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>,<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>,<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>))</span></code></pre></div>
<pre><code>## Time Series:
## Start = 1 
## End = 7 
## Frequency = 1 
## [1]        NA  8.333333  9.333333 11.666667 10.666667 13.333333        NA</code></pre>
<p>Let’s pause and see what these estimates look like:</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="forecasting.html#cb215-1" tabindex="-1"></a>preds <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x=</span><span class="dv">8</span>,</span>
<span id="cb215-2"><a href="forecasting.html#cb215-2" tabindex="-1"></a>                <span class="at">yhat=</span><span class="fu">c</span>(yhat1,yhat2,yhat3),</span>
<span id="cb215-3"><a href="forecasting.html#cb215-3" tabindex="-1"></a>                <span class="at">description=</span><span class="fu">c</span>(<span class="st">&quot;mean&quot;</span>,<span class="st">&quot;moving avg&quot;</span>,<span class="st">&quot;weighted moving avg&quot;</span>))</span>
<span id="cb215-4"><a href="forecasting.html#cb215-4" tabindex="-1"></a>p1 <span class="sc">+</span> <span class="fu">geom_point</span>(preds,<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>yhat),</span>
<span id="cb215-5"><a href="forecasting.html#cb215-5" tabindex="-1"></a>                <span class="at">color=</span><span class="st">&quot;blue&quot;</span>,<span class="at">size=</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb215-6"><a href="forecasting.html#cb215-6" tabindex="-1"></a>  <span class="fu">geom_text</span>(preds,<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>yhat,<span class="at">label=</span>description),</span>
<span id="cb215-7"><a href="forecasting.html#cb215-7" tabindex="-1"></a>            <span class="at">position =</span> <span class="fu">position_nudge</span>(<span class="at">y =</span> <span class="sc">-</span><span class="fl">0.25</span>),<span class="at">color=</span><span class="st">&quot;blue&quot;</span>,<span class="at">size=</span><span class="dv">3</span>)</span></code></pre></div>
<p><img src="05TimeSeries-Forecast_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>These are all reasonable predictions but not especially interesting. But let’s think about the weighted moving average differently. Imagine the weighted average where we consider the entire series and assign exponentially smaller weights as we go back in time. For example if we started with a smoothing coefficient of <span class="math inline">\(\alpha = 0.9\)</span>, our weights going back in time from 7 would be:</p>
<p><span class="math display">\[0.9^1, 0.9^2, 0.9^3, 0.9^4, 0.9^5, ...\]</span>
Or:
<span class="math display">\[0.900, 0.810, 0.729, 0.656, 0.590, ... \]</span></p>
<p>You can see that this decreases in a predictable negative exponential decay and as the time step backwards increases the weights approach zero. E.g., if we used <span class="math inline">\(\alpha = 0.9\)</span> and looked at the weights going back 50 time steps:</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="forecasting.html#cb216-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">50</span></span>
<span id="cb216-2"><a href="forecasting.html#cb216-2" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fl">0.9</span><span class="sc">^</span>x</span>
<span id="cb216-3"><a href="forecasting.html#cb216-3" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>y)) <span class="sc">+</span></span>
<span id="cb216-4"><a href="forecasting.html#cb216-4" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;Weight&quot;</span>,</span>
<span id="cb216-5"><a href="forecasting.html#cb216-5" tabindex="-1"></a>       <span class="at">x=</span><span class="st">&quot;Number of backwards time steps&quot;</span>)</span></code></pre></div>
<p><img src="05TimeSeries-Forecast_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<p>You’ve probably spotted a problem. We can’t use these weights like we did the moving average because the that the series sums to more than one. That screws up the weighted moving average concept. What Holt (or maybe all the way back to Poisson – I’m not up on the history of math) did was solve this elegantly as:
<span class="math display">\[ \hat y_t  = \alpha \times y_t + (1 - \alpha) \times \hat y_{t-1}\]</span></p>
<p>Spend some time appreciating this formula. It shows that your estimate is the sum of two products. This is essentially a weighted average with <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(1 - \alpha\)</span> as the weights. Since these two terms sum to one we can use it as a moving average.</p>
<p>This is a recursive formula where <span class="math inline">\(1 - \alpha\)</span> is multiplied by the prior expected value <span class="math inline">\(\hat y_{t-1}\)</span> so this crawls back to the beginning of the series. We implement this in a loop:</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="forecasting.html#cb217-1" tabindex="-1"></a>expFunc <span class="ot">&lt;-</span> <span class="cf">function</span>(x,<span class="at">alpha=</span><span class="fl">0.5</span>){</span>
<span id="cb217-2"><a href="forecasting.html#cb217-2" tabindex="-1"></a>  xhat <span class="ot">&lt;-</span> x[<span class="dv">1</span>]</span>
<span id="cb217-3"><a href="forecasting.html#cb217-3" tabindex="-1"></a>  nx <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb217-4"><a href="forecasting.html#cb217-4" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>nx){</span>
<span id="cb217-5"><a href="forecasting.html#cb217-5" tabindex="-1"></a>    xhat[i] <span class="ot">&lt;-</span> alpha <span class="sc">*</span> x[i] <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> alpha) <span class="sc">*</span> x[i<span class="dv">-1</span>]</span>
<span id="cb217-6"><a href="forecasting.html#cb217-6" tabindex="-1"></a>  }</span>
<span id="cb217-7"><a href="forecasting.html#cb217-7" tabindex="-1"></a>  xhat[nx]</span>
<span id="cb217-8"><a href="forecasting.html#cb217-8" tabindex="-1"></a>}</span>
<span id="cb217-9"><a href="forecasting.html#cb217-9" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">8</span>,<span class="dv">5</span>,<span class="dv">12</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">9</span>,<span class="dv">19</span>)</span>
<span id="cb217-10"><a href="forecasting.html#cb217-10" tabindex="-1"></a>yhat <span class="ot">&lt;-</span> <span class="fu">expFunc</span>(y,<span class="at">alpha=</span><span class="fl">0.9</span>)</span>
<span id="cb217-11"><a href="forecasting.html#cb217-11" tabindex="-1"></a>yhat</span></code></pre></div>
<pre><code>## [1] 18</code></pre>
<p>We can see what these look like for different values of <span class="math inline">\(\alpha\)</span>:</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="forecasting.html#cb219-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span></span>
<span id="cb219-2"><a href="forecasting.html#cb219-2" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">8</span>,<span class="dv">5</span>,<span class="dv">12</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">9</span>,<span class="dv">19</span>)</span>
<span id="cb219-3"><a href="forecasting.html#cb219-3" tabindex="-1"></a>preds <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x=</span><span class="dv">8</span>,</span>
<span id="cb219-4"><a href="forecasting.html#cb219-4" tabindex="-1"></a>                <span class="at">yhat=</span><span class="fu">c</span>(<span class="fu">expFunc</span>(y,<span class="at">alpha=</span><span class="fl">0.8</span>),</span>
<span id="cb219-5"><a href="forecasting.html#cb219-5" tabindex="-1"></a>                       <span class="fu">expFunc</span>(y,<span class="at">alpha=</span><span class="fl">0.4</span>),</span>
<span id="cb219-6"><a href="forecasting.html#cb219-6" tabindex="-1"></a>                       <span class="fu">expFunc</span>(y,<span class="at">alpha=</span><span class="fl">0.2</span>)),</span>
<span id="cb219-7"><a href="forecasting.html#cb219-7" tabindex="-1"></a>                <span class="at">description=</span><span class="fu">c</span>(<span class="st">&quot;alpha = 0.8&quot;</span>,</span>
<span id="cb219-8"><a href="forecasting.html#cb219-8" tabindex="-1"></a>                              <span class="st">&quot;alpha = 0.4&quot;</span>,</span>
<span id="cb219-9"><a href="forecasting.html#cb219-9" tabindex="-1"></a>                              <span class="st">&quot;alpha = 0.2&quot;</span>))</span>
<span id="cb219-10"><a href="forecasting.html#cb219-10" tabindex="-1"></a></span>
<span id="cb219-11"><a href="forecasting.html#cb219-11" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>y)) <span class="sc">+</span> </span>
<span id="cb219-12"><a href="forecasting.html#cb219-12" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb219-13"><a href="forecasting.html#cb219-13" tabindex="-1"></a>  <span class="fu">lims</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">9</span>)) <span class="sc">+</span> </span>
<span id="cb219-14"><a href="forecasting.html#cb219-14" tabindex="-1"></a>  <span class="fu">geom_point</span>(preds,<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>yhat),</span>
<span id="cb219-15"><a href="forecasting.html#cb219-15" tabindex="-1"></a>             <span class="at">color=</span><span class="st">&quot;blue&quot;</span>,<span class="at">size=</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb219-16"><a href="forecasting.html#cb219-16" tabindex="-1"></a>  <span class="fu">geom_text</span>(preds,<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>yhat,<span class="at">label=</span>description),</span>
<span id="cb219-17"><a href="forecasting.html#cb219-17" tabindex="-1"></a>            <span class="at">position =</span> <span class="fu">position_nudge</span>(<span class="at">y =</span> <span class="sc">-</span><span class="fl">0.25</span>),<span class="at">color=</span><span class="st">&quot;blue&quot;</span>,<span class="at">size=</span><span class="dv">3</span>)</span></code></pre></div>
<p><img src="05TimeSeries-Forecast_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<p>This is the base concept underneath Holt-Winters smoothing. The book walks you through how to go from <span class="math inline">\(\hat y_t  = \alpha \times y_t + (1 - \alpha) \times \hat y_{t-1}\)</span> (eq. 3.15) to the entire Holt-Winters method (eq. 3.21) which is composed of combining the simple smoothing as shown above (<span class="math inline">\(\alpha\)</span>) with the trend (<span class="math inline">\(\beta\)</span>) and seasonality (<span class="math inline">\(\gamma\)</span>) to to do the forecasting. The trick is figuring out what the parameters (<span class="math inline">\(\alpha\)</span>, <span class="math inline">\(\beta\)</span>, <span class="math inline">\(\gamma\)</span>) are. The <code>HoltWinters</code> function does this with numeric optimization – in the default case minimizing the sum of the squared errors for all three parameters.</p>
<p>Here is it in action:</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="forecasting.html#cb220-1" tabindex="-1"></a>fname <span class="ot">&lt;-</span> <span class="st">&quot;https://www.esrl.noaa.gov/gmd/webdata/ccgg/trends/co2/co2_mm_mlo.txt&quot;</span></span>
<span id="cb220-2"><a href="forecasting.html#cb220-2" tabindex="-1"></a>co2 <span class="ot">&lt;-</span> <span class="fu">read.table</span>(fname)</span>
<span id="cb220-3"><a href="forecasting.html#cb220-3" tabindex="-1"></a>co2 <span class="ot">&lt;-</span> co2[,<span class="dv">4</span>]</span>
<span id="cb220-4"><a href="forecasting.html#cb220-4" tabindex="-1"></a>co2 <span class="ot">&lt;-</span> <span class="fu">ts</span>(co2,<span class="at">start=</span><span class="fu">c</span>(<span class="dv">1958</span>,<span class="dv">3</span>),<span class="at">frequency =</span> <span class="dv">12</span>)</span>
<span id="cb220-5"><a href="forecasting.html#cb220-5" tabindex="-1"></a>hw <span class="ot">&lt;-</span> <span class="fu">HoltWinters</span>(co2)</span>
<span id="cb220-6"><a href="forecasting.html#cb220-6" tabindex="-1"></a>hw</span></code></pre></div>
<pre><code>## Holt-Winters exponential smoothing with trend and additive seasonal component.
## 
## Call:
## HoltWinters(x = co2)
## 
## Smoothing parameters:
##  alpha: 0.5306546
##  beta : 0.01455503
##  gamma: 0.3019897
## 
## Coefficients:
##            [,1]
## a   427.2432590
## b     0.2152986
## s1   -1.7319226
## s2   -3.1603238
## s3   -3.1203881
## s4   -1.7525459
## s5   -0.4967728
## s6    0.4805736
## s7    1.1996301
## s8    1.6694987
## s9    2.9822135
## s10   3.4534960
## s11   2.7131830
## s12   0.6168803</code></pre>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="forecasting.html#cb222-1" tabindex="-1"></a><span class="fu">plot</span>(co2,<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">1980</span>,<span class="dv">2040</span>),<span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">340</span>,<span class="dv">460</span>),</span>
<span id="cb222-2"><a href="forecasting.html#cb222-2" tabindex="-1"></a>     <span class="at">ylab=</span><span class="fu">expression</span>(CO[<span class="dv">2</span>]<span class="sc">~</span>(ppm)))</span>
<span id="cb222-3"><a href="forecasting.html#cb222-3" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">predict</span>(hw,<span class="at">n.ahead =</span> <span class="dv">120</span>),<span class="at">col=</span><span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img src="05TimeSeries-Forecast_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
</div>
<div id="your-work-4" class="section level2 hasAnchor" number="8.8">
<h2><span class="header-section-number">8.8</span> Your work<a href="forecasting.html#your-work-4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="a-silly-prediction" class="section level3 hasAnchor" number="8.8.1">
<h3><span class="header-section-number">8.8.1</span> A silly prediction<a href="forecasting.html#a-silly-prediction" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let’s look at <a href="https://www.esrl.noaa.gov/gmd/ccgg/trends_ch4/">globally averaged methane</a> concentrations. The data are monthly and run back to 1983.</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="forecasting.html#cb223-1" tabindex="-1"></a>fname <span class="ot">&lt;-</span> <span class="st">&quot;https://gml.noaa.gov/webdata/ccgg/trends/ch4/ch4_mm_gl.txt&quot;</span></span>
<span id="cb223-2"><a href="forecasting.html#cb223-2" tabindex="-1"></a>ch4 <span class="ot">&lt;-</span> <span class="fu">read.table</span>(fname)</span>
<span id="cb223-3"><a href="forecasting.html#cb223-3" tabindex="-1"></a>ch4 <span class="ot">&lt;-</span> ch4[,<span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb223-4"><a href="forecasting.html#cb223-4" tabindex="-1"></a><span class="fu">names</span>(ch4) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;DecimalDate&quot;</span>,<span class="st">&quot;ppb&quot;</span>)</span>
<span id="cb223-5"><a href="forecasting.html#cb223-5" tabindex="-1"></a></span>
<span id="cb223-6"><a href="forecasting.html#cb223-6" tabindex="-1"></a><span class="fu">ggplot</span>(ch4,<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x=</span>DecimalDate,<span class="at">y=</span>ppb)) <span class="sc">+</span></span>
<span id="cb223-7"><a href="forecasting.html#cb223-7" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb223-8"><a href="forecasting.html#cb223-8" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;Date&quot;</span>,<span class="at">y=</span><span class="fu">expression</span>(CH[<span class="dv">4</span>]<span class="sc">~</span>(ppb)),</span>
<span id="cb223-9"><a href="forecasting.html#cb223-9" tabindex="-1"></a>       <span class="at">title=</span><span class="st">&quot;Global Monthly Mean Methane Concentration&quot;</span>)</span></code></pre></div>
<p><img src="05TimeSeries-Forecast_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="forecasting.html#cb224-1" tabindex="-1"></a><span class="co"># make a ts object</span></span>
<span id="cb224-2"><a href="forecasting.html#cb224-2" tabindex="-1"></a>ch4.ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(ch4<span class="sc">$</span>ppb,<span class="at">start=</span><span class="fu">c</span>(<span class="dv">1983</span>,<span class="dv">7</span>),<span class="at">frequency =</span> <span class="dv">12</span>)</span></code></pre></div>
<div id="train-and-test" class="section level4 hasAnchor" number="8.8.1.1">
<h4><span class="header-section-number">8.8.1.1</span> Train and Test<a href="forecasting.html#train-and-test" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Let’s divide the data into two parts. The first chuck of the time series we can use for training a model and we can use the second chunk for testing the model. Thus, you can forecast the training data over the time period of the data you withheld and see how compares it to the test data. This is standard model building stuff to do, right? Training and testing data are fantastic ways of withholding information in order to assess a model’s skill (as long as you have data to spare).</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="forecasting.html#cb225-1" tabindex="-1"></a>ch4.train <span class="ot">&lt;-</span> <span class="fu">window</span>(ch4.ts, <span class="at">end =</span> <span class="dv">2016</span>)</span>
<span id="cb225-2"><a href="forecasting.html#cb225-2" tabindex="-1"></a>ch4.test <span class="ot">&lt;-</span> <span class="fu">window</span>(ch4.ts, <span class="at">start =</span> <span class="dv">2016</span>)</span>
<span id="cb225-3"><a href="forecasting.html#cb225-3" tabindex="-1"></a></span>
<span id="cb225-4"><a href="forecasting.html#cb225-4" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb225-5"><a href="forecasting.html#cb225-5" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data=</span>broom<span class="sc">::</span><span class="fu">tidy</span>(ch4.train),</span>
<span id="cb225-6"><a href="forecasting.html#cb225-6" tabindex="-1"></a>            <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x=</span>index,<span class="at">y=</span>value),</span>
<span id="cb225-7"><a href="forecasting.html#cb225-7" tabindex="-1"></a>            <span class="at">color=</span><span class="st">&quot;darkred&quot;</span>) <span class="sc">+</span></span>
<span id="cb225-8"><a href="forecasting.html#cb225-8" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data=</span>broom<span class="sc">::</span><span class="fu">tidy</span>(ch4.test),</span>
<span id="cb225-9"><a href="forecasting.html#cb225-9" tabindex="-1"></a>            <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x=</span>index,<span class="at">y=</span>value),</span>
<span id="cb225-10"><a href="forecasting.html#cb225-10" tabindex="-1"></a>            <span class="at">color=</span><span class="st">&quot;darkblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb225-11"><a href="forecasting.html#cb225-11" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">2016</span>) <span class="sc">+</span></span>
<span id="cb225-12"><a href="forecasting.html#cb225-12" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="dv">2016</span>,<span class="at">y=</span><span class="dv">1900</span>,<span class="at">label=</span><span class="st">&quot;Train  Test&quot;</span>),<span class="at">nudge_x =</span> <span class="sc">-</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb225-13"><a href="forecasting.html#cb225-13" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;Date&quot;</span>,<span class="at">y=</span><span class="fu">expression</span>(CH[<span class="dv">4</span>]<span class="sc">~</span>(ppb)),</span>
<span id="cb225-14"><a href="forecasting.html#cb225-14" tabindex="-1"></a>       <span class="at">title=</span><span class="st">&quot;Global Monthly Mean Methane Concentration&quot;</span>) <span class="sc">+</span></span>
<span id="cb225-15"><a href="forecasting.html#cb225-15" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="05TimeSeries-Forecast_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
</div>
<div id="arp-forecast" class="section level4 hasAnchor" number="8.8.1.2">
<h4><span class="header-section-number">8.8.1.2</span> AR(<span class="math inline">\(p\)</span>) Forecast<a href="forecasting.html#arp-forecast" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>And fit an AR(<span class="math inline">\(p\)</span>) model via:</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="forecasting.html#cb226-1" tabindex="-1"></a>ch4.ar <span class="ot">&lt;-</span> <span class="fu">ar</span>(ch4.train)</span>
<span id="cb226-2"><a href="forecasting.html#cb226-2" tabindex="-1"></a>ch4.ar</span></code></pre></div>
<pre><code>## 
## Call:
## ar(x = ch4.train)
## 
## Coefficients:
##       1        2        3        4  
##  1.0802  -0.1542  -0.0289   0.0891  
## 
## Order selected 4  sigma^2 estimated as  71.72</code></pre>
<p>Forecast the training data over the period of the testing data. Overlay the testing data on your plot. How do they compare visually? Now compare the predicted data to the withheld (test) data statistically (e.g., correlation and RMSE). Is this a “good” model? Can you explain what is going on with these predictions?</p>
</div>
<div id="holt-winters-forecast" class="section level4 hasAnchor" number="8.8.1.3">
<h4><span class="header-section-number">8.8.1.3</span> Holt-Winters Forecast<a href="forecasting.html#holt-winters-forecast" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>And make a Holt-winters model too.</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="forecasting.html#cb228-1" tabindex="-1"></a>ch4.hw <span class="ot">&lt;-</span> <span class="fu">HoltWinters</span>(ch4.train)</span></code></pre></div>
<pre><code>## Warning in HoltWinters(ch4.train): optimization difficulties: ERROR:
## ABNORMAL_TERMINATION_IN_LNSRCH</code></pre>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="forecasting.html#cb230-1" tabindex="-1"></a>ch4.hw</span></code></pre></div>
<pre><code>## Holt-Winters exponential smoothing with trend and additive seasonal component.
## 
## Call:
## HoltWinters(x = ch4.train)
## 
## Smoothing parameters:
##  alpha: 0.8729582
##  beta : 0.01981042
##  gamma: 1
## 
## Coefficients:
##             [,1]
## a   1839.8827680
## b      0.5998914
## s1     1.8281395
## s2     1.3145093
## s3     0.5110901
## s4    -1.9972249
## s5    -7.0008862
## s6    -9.9788581
## s7    -6.6378429
## s8    -0.2315650
## s9     4.5676653
## s10    6.2974446
## s11    4.8814883
## s12    2.5872320</code></pre>
<p>Forecast the training data over the period of the testing data. Overlay the testing data on your plot. How do they compare visually? Now compare the predicted data to the withheld (test) data statistically (e.g., correlation and RMSE). Is this a “good” model? Can you explain what is going on with these predictions?</p>
</div>
</div>
<div id="write-up-and-reflect-4" class="section level3 hasAnchor" number="8.8.2">
<h3><span class="header-section-number">8.8.2</span> Write Up and Reflect<a href="forecasting.html#write-up-and-reflect-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Pass in a R Markdown doc with your analysis. Leave all code visible, although you may quiet messages and warnings if desired. Turn in your knitted html. The last section of your document should include a reflection where you explain how it all went. What triumphs did you have? What is still confusing?</p>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="4">
<li id="fn4"><p>Please use these automatic functions with care. They are blind algorithms that just operate until their stopping criteria are met. With great power comes great responsibility. They optimize based on information criteria, not predictive power. E.g.,<code>auto.arima</code> uses AICc, AIC, or BIC to pick models. These penalize complexity, but not harshly enough when sample sizes are large or when noise structures are complex. A model can “look” optimal by those criteria yet still generalize poorly. By default, <code>auto.arima</code> will consider fairly large values for AR and MA terms (max.p = 5, max.q = 5), which can fit noise patterns. In short samples, this is especially risky. In time series, near-identical scores can come from very different models. Without domain insight, functions like <code>auto.arima</code> might favor a more complex model that explains idiosyncrasies and not the “truth.”<a href="forecasting.html#fnref4" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="armapq.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="cross-correlation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "section",
    "scroll_highlight": true
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
